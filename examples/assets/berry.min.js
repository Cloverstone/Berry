Berry=function(e,t){this.list=function(e){var t=this.fields;if(typeof e!=="undefined"){t=this.find(e)}temp=[];this.each(function(e){console.log(this.getPath());e.push(this.getPath())},temp,t);return temp};this.destroy=function(){this.each(function(){if(typeof this.destroy==="function"){this.destroy()}});this.trigger("destroy");this.$el.empty();for(var e in this.fieldsets){$(this.fieldsets[e]).empty()}this.fields={};if(typeof this.renderer.destroy==="function"){this.renderer.destroy()}delete Berry.instances[this.options.name];this.trigger("destroyed")};this.search=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1");t=t.replace(/^\./,"");var n=t.split(".");while(n.length){var r=n.shift();if(r in e){e=e[r]}else{return e}}return e};this.toJSON=function(e,t){if(t){this.validate()}if(typeof e==="string"){return this.search(this.attributes,e)}else{o();this.working=$.extend(true,{},this.attributes);this.working=n(this.working);if(this.options.flatten&&true){this.deflated=[];this.each(function(){if(this.isContainer&&this.owner.options.flatten&&(this.instance_id===null||this.instance_id===0)){if(this.isChild()){var e=this.parent.getPath().split(".");var t=[];for(var n=e.length-1;n>=0;n--){var r=e[n];if(-1===e.indexOf(r)){t.push(r)}}e=t;var i=e.pop();var s=e.join(".");if(e.length){this.owner.search(this.owner.working,s)[i]=this.owner.deflate(this.owner.search(this.owner.working,this.getPath()))}else{if(i){this.owner.working[i]=this.owner.deflate(this.owner.search(this.owner.working,this.getPath()))}else{$.extend(this.owner.working,this.owner.deflate(this.owner.search(this.owner.working,this.name)));delete this.owner.working[this.name]}}this.owner.deflated.push(this.name)}else{this.owner.deflated.push(this.name);$.extend(this.owner.working,this.owner.deflate(this.owner.working[this.name]));delete this.owner.working[this.name]}}});this.working=this.deflate(this.working)}return this.working}};this.deflate=function(e){var t;var n={};for(var r in e){if(typeof e[r]==="object"){if($.isArray(e[r])){n[r]=[];for(t in e[r]){n[r].push(e[r][t])}}else{n[r]={};for(t in e[r]){n[r][t]=e[r][t]}}}else{n[r]=e[r]}}return n};this.populate=function(e){e=e||this.fields;this.each(function(){if(this.multiple){var e={};e=this.owner.toJSON(this.getPath());if(e){var t=true;for(var n in e){if(!t){this.owner.processField($.extend({},this.item,{id:Berry.getUID(),name:this.name}),$(this.self),this.parent,"after")}else{t=false}}}}},e);f.each(function(){if(!this.isContainer){var e=this.owner.toJSON(this.getPath());this.setValue(e||"");this.trigger("change");this.toJSON()}},e)};var n=function(e){f.altered=$.extend(true,{},e);f.each(function(){if(this.multiple&&this.toArray){var e=this.owner.toJSON(this.getPath());var t=this.owner.attributes;if(this.isChild()){t=this.owner.search(this.owner.altered,this.parent.getPath())}t[this.name]={};for(var n in this.children){t[this.name][n]=$.pluck(e,n)}}});return f.altered};var r=function(){f.each(function(){if(this.multiple&&this.toArray){var e=this.owner.attributes[this.name];if(this.isChild()){e=this.owner.search(this.owner.attributes,this.getSearchPath())}if(e){var t=$.extend(true,{},e[this.name]);e[this.name]=[];var n=this.owner.source;if(this.isChild()){n=this.owner.search(this.owner.source,this.parent.getPath())}else{}for(var r in n[this.name]){for(var i in n[this.name][r]){var s=$.extend({},t);for(var o in t){s[o]=n[this.name][o][i]}e[this.name].push(s)}break}}}else{if(typeof this.owner.source[this.name]==="object"){if($.isArray(this.owner.source[this.name])){this.owner.attributes[this.name]=$.extend([],this.owner.source[this.name])}else{this.owner.attributes[this.name]=$.extend({},this.owner.source[this.name])}}else{this.owner.attributes[this.name]=this.owner.source[this.name]}}});return f.attributes};var i=function(e,t){for(var n in t){if(typeof t[n]==="object"&&!$.isArray(t[n])){if(n in e){t[n]=i(e[n],t[n])}else{t[n]=i(e,t[n])}}else{if(n in e){t[n]=e[n]}}}return t};this.toArray=function(){var e=[];for(var t in this.fields){e.push(this.fields[t])}return e};this.each=function(e,t,n){n=n||this.fields;var r=true;for(var i in n){if(r!==false){var s=n[i];if(s.item){if(s.isActive()){r=e.call(s,t)}}else if(!$.isEmptyObject(s.instances)){r=this.each(e,t,s.instances)}if(!$.isEmptyObject(s.children)){r=this.each(e,t,s.children)}}else{break}}if(r){return t}else{return r}};this.find=function(e,t){var n=t||this.fields;e=e.replace(/\[(\w+)\]/g,".$1");e=e.replace(/^\./,"");var r=e.split(".");while(r.length){var i=r.shift();var s=this.shallowFind(i,n);if(s){if(!$.isEmptyObject(s.children)){n=s.children}else{n=s.fields||s}}else{return false}}return n};this.shallowFind=function(e,t){t=t||this.fields;for(var n in t){if(n==e){if(typeof t[n].instances!=="undefined"){if(t[n].multiple){return t[n].instances}else{return t[n].instances[0]}}return t[n]}if(!$.isEmptyObject(field.children)){var r=this.shallowFind(e,field.children);if(r){return r}}}return false};this.processfields=function(e,t,n){for(var r in e){if(typeof e[r]==="string"){e[r]={type:e[r],label:r}}e[r]=$.extend({},f.options.default,e[r]);if(typeof e[r].name==="undefined"&&!e[r].isContainer){if(typeof e[r].id!=="undefined"){e[r].name=e[r].id}else{e[r].name=r.toLowerCase().split(" ").join("_")}}if(typeof e[r].label==="undefined"&&e[r].label!==false){e[r].label=r}if(e[r].required){$.extend(e[r],{validate:{required:true}})}if(typeof e[r].validate!=="undefined"){e[r].required=e[r].validate.required}this.processField(e[r],t,n)}};this.processField=function(e,t,n,r){field=$.extend({},f.options.default,e);if(t[0]!==undefined){t=t[0]}if(field.type in Berry.types){var i=s(field,n,t,r);if(i.fieldset===undefined){i.fieldset=t}if(r=="before"){$(t).before(i.render())}else if(r=="after"){$(t).after(i.render())}else{$(i.fieldset).append(i.render())}i.initialize();return i}return false};var s=function(e,t,n,r){var i=new Berry.types[e.type](e,f);i.parent=t;var s=f.fields;if(t!==null&&t!==undefined){s=t.children}var o=s[i.name]!==undefined;if(i.isContainer){if(!o){s[i.name]={isContainer:true,multiple:i.multiple,hasChildren:!$.isEmptyObject(e.fields),toArray:i.item.toArray||i.owner.options.flatten,instances:[]}}var u=s[i.name].instances.length;var a=$(n).attr("id");for(var l in s[i.name].instances){if(s[i.name].instances[l].id==a){u=parseInt(l,10)+1;break}}s[i.name].instances.splice(u,0,i);var c=0;for(var h in s[i.name].instances){s[i.name].instances[h].instance_id=c++}}else{if(o||i.multiple){if(s[i.name].isContainer){if(!f.options.flatten){var p=[];p.push(s[i.name]);p=s[i.name];s[i.name]={multiple:i.multiple,hasChildren:!$.isEmptyObject(e.fields),instances:[]};s[i.name].instances.push(p)}}else if(s[i.name]instanceof Berry.field){var p=[];p.push(s[i.name]);p=s[i.name];s[i.name]={instances:[]};s[i.name].instances.push(p)}s[i.name].instances.push(i)}else{s[i.name]=i}}return i};var o=function(){f.each(function(){if(!this.isContainer){var e;if(this.isChild()||this.instance_id!==null){e=this.owner.search(this.owner.attributes,this.parent.getPath())}else{e=this.owner.attributes}if($.isArray(e)){e[this.parent.instance_id][this.name]=this.getValue()}else{e[this.name]=this.getValue()}}});return f.attributes};var u=function(){f.each(function(){this.toJSON()});o();return f.attributes};var a=function(e){if(e){if(!f.options.actionTarget){f.options.actionTarget=$('<div class="berry-actions" style="overflow:hidden;padding-bottom:10px"></div>');f.target.append(f.options.actionTarget)}e=containsKey(Berry.btn,e);for(var t in e){var n=$(Berry.render("berry__action",e[t]));if(typeof e[t].click==="function"){n.click($.proxy(e[t].click,f))}f.options.actionTarget.append(n)}}};var f=this;this.$el=t;this.fieldsets=[];this.section_count=0;this.sections=[];this.sectionList=[];this.options=$.extend(true,{name:Berry.getUID(),errorClass:"has-error",errorTextClass:"font-xs.text-danger",options:{inline:false},modifiers:"",renderer:"base",flatten:true,autoDestroy:false,autoFocus:true,"default":{type:"text"},actions:["save"]},e);this.events=$.extend({},Berry.prototype.events);this.changed=false;this.fields={};this.source={};this.attributes={};this.trigger("initialize");if(typeof this.$el==="undefined"){t=$("<div/>")}this.renderer=new Berry.renderers[this.options.renderer](this);this.target=this.renderer.render();if(this.options.legend&&this.options.legendTarget){this.options.legendTarget.append(this.options.legend)}this.processfields(this.options.fields,this.target,null);if(typeof this.options.attributes!=="undefined"){this.source=$.extend(true,{},this.options.attributes);if(this.options.flatten){this.source=i($.extend(true,{},this.source),$.extend(true,{},n(this.attributes)))||{}}r();this.populate()}a(this.options.actions);if(typeof this.renderer.initialize==="function"){this.renderer.initialize()}if(this.options.autoFocus){this.each(function(){this.focus();return false})}this.each(function(){this.trigger("change")});Berry.instances[this.options.name]=this;this.on("dropped",function(e){var t=this.find(e.path);var n="";for(var r in t){if(t[r].id==e.id){n=t[r].getPath();t.splice(r,1);break}}var i=f.attributes;var s=n;s=s.replace(/\[(\w+)\]/g,".$1");s=s.replace(/^\./,"");var o=s.split(".");while(o.length){var u=o.shift();if(u in i){i=i[u]}}if($.isArray(i)){i.splice(r,1)}else{delete i[r];var a=0;for(var l in i){if(l>=r){i[r++]=i[l];delete i[l]}}}})};Berry.prototype.events={initialize:[]};Berry.prototype.addSub=function(e,t){if(!this.events[e]){this.events[e]=[]}var n=Berry.getUID();this.events[e].push({token:n,func:t});return n};Berry.prototype.on=function(e,t,n){var r=/\s+/;if(r.test(e)){var i=e.split(r);for(var s in i){this.addSub(i[s],t)}}else{this.lastToken=this.addSub(e,t)}if(n){t.call(this,null,e)}return this};Berry.prototype.off=function(e){for(var t in this.events){if(this.events[t]){for(var n=0,r=this.events[t].length;n<r;n++){if(this.events[t][n].token===e){this.events[t].splice(n,1);return e}}}}return this};Berry.prototype.processTopic=function(e,t){if(this.events[e]){var n=this.events[e],r=n?n.length:0;while(r--){n[r].func.call(this,t,e,n[r].token)}}};Berry.prototype.trigger=function(e,t){if(this.events[e]){var n=this.events[e],r=n?n.length:0;while(r--){n[r].func.call(this,t,e,n[r].token)}}newtopic=e.split(":")[0];if(newtopic!==e){e=newtopic;if(this.events[e]){var n=this.events[e],r=n?n.length:0;while(r--){n[r].func.call(this,t,e,n[r].token)}}}return this};Berries=Berry.instances={};Berry.field=function(e,t){this.children={};this.owner=t;this.hidden=false;this.item=$.extend(true,{},this.defaults,e);$.extend(this,this.owner.options.options,this.item);if(e.value!==0){if(typeof e.value==="function"){this.valueFunc=e.value;this.liveValue=function(){return this.valueFunc.call(this.owner.toJSON())};e.value=this.item.value=this.liveValue();this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))}else{this.value=e.value||this.value||e.default||""}}else{this.value=0}this.lastSaved=this.liveValue();this.id=e.id||Berry.getUID();this.self=undefined;this.fieldset=undefined;if(this.item.fieldset!==undefined&&$("."+this.item.fieldset).length>0){this.fieldset=$("."+this.item.fieldset)[0];this.owner.fieldsets.push(this.fieldset)}else{if(this.item.fieldset!==undefined&&$("[name="+this.item.fieldset+"]").length>0){this.fieldset=$("[name="+this.item.fieldset+"]")[0];this.owner.fieldsets.push(this.fieldset)}}this.val=function(e){if(typeof e!=="undefined"){this.set(e)}return this.getValue()}};$.extend(Berry.field.prototype,{type:"text",version:"1.0",isContainer:false,instance_id:null,path:"",defaults:{},parent:null,getPath:function(){var e="";if(this.parent!==null&&this.parent!==undefined){e=this.parent.getPath()+".";if(this.parent.multiple){e+=this.parent.instance_id+"."}}return e+this.name},getSearchPath:function(){var e="";if(this.parent!==null&&this.parent!==undefined){e=this.parent.getSearchPath()+".";e+=this.parent.instance_id+"."}return e+this.name},isActive:function(){return this.parent===null||this.parent.enabled!==false},isChild:function(){return this.parent!==null},set:function(e){if(this.value!==e){this.value=e;this.setValue(this.value);this.trigger("changed")}},revert:function(){this.value=this.lastSaved;this.item.value=this.lastSaved;this.setValue(this.value)},hasChildren:function(){return!$.isEmptyObject(this.children)},create:function(e){return Berry.render("berry_"+(this.elType||this.type),this)},render:function(){if(typeof this.self==="undefined"){this.self=$(this.create()).attr("data-Berry",this.owner.options.name)}else{this.self.html($(this.create()).html())}this.display=this.getDisplay();return this.self},getValue:function(){return this.$el.val()},toJSON:function(){this.value=this.getValue();this.lastSaved=this.value;this.display=this.getDisplay();return this.lastSaved},liveValue:function(){return this.value},setup:function(){this.$el=this.self.find("input");this.$el.off();if(this.onchange!==undefined){this.$el.on("input",this.onchange)}this.$el.on("input",$.proxy(function(){this.trigger("change")},this));if(this.item.mask&&$.fn.mask){this.$el.mask(this.item.mask)}},createAttributes:function(){var e=this.owner.attributes;if(this.isContainer){if(this.multiple){if(this.isChild()){e=this.owner.search(e,this.parent.getPath())}e[this.name]=e[this.name]||[]}else{e[this.name]={}}}else{var t=this.getPath();t=t.replace(/\[(\w+)\]/g,".$1");t=t.replace(/^\./,"");var n=t.split(".");while(n.length){var r=n.shift();if(r in e){e=e[r]}else{if(r==this.name){e=e[r]=this.value}else{e=e[r]={}}}}}},initialize:function(){if(this.multiple&&this.multiple.duplicate){this.self.find(".duplicate").click($.proxy(this.dupeMe,this));this.self.find(".remove").click($.proxy(this.dropMe,this))}this.createAttributes();this.setup();if(typeof this.show!=="undefined"){this.showConditions=Berry.processConditions.call(this,this.show,function(e,t){this.showConditions[t]=e;this.self.show();for(var n in this.showConditions){if(!this.showConditions[n]){this.self.hide();break}}})}if(this.enabled){this.enabledConditions=Berry.processConditions.call(this,this.enabled,function(e,t){this.enabledConditions[t]=e;this.enabledState=true;this.enable();for(var n in this.enabledConditions){if(!this.enabledConditions[n]){this.enabledState=false;this.disable();break}}})}},on:function(e,t){this.owner.on(e+":"+this.name,t)},trigger:function(e){this.value=this.getValue();this.owner.trigger(e+":"+this.name,{type:this.type,name:this.name,id:this.id,value:this.value,path:this.getPath()})},setValue:function(e){if(typeof this.lastSaved==="undefined"){this.lastSaved=e}this.value=e;return this.$el.val(e)},update:function(e,t){$.extend(this.item,e);$.extend(this,this.item);this.setValue(this.value);this.render();this.setup();if(!t){this.trigger("change")}},blur:function(){this.$el.blur()},focus:function(){this.$el.focus().val("").val(this.value)},disable:function(){this.$el.prop("disabled",true)},enable:function(){this.$el.prop("disabled",false)},displayAs:function(){return this.lastSaved},getDisplay:function(){if(this.displayAs!==undefined){if(this.item.template!==undefined){this.display=this.displayAs();return Berry.render(this.item.template,this)[0]}else{return this.displayAs()||"Empty"}}else{if(this.item.template!==undefined){return Berry.render(this.item.template,this)[0]}else{return this.lastSaved||"Empty"}}},destroy:function(){if(this.$el){this.$el.off()}},dupeMe:function(){var e=this.self;var t=this.max||-1;var n=$(e).siblings("[name="+this.name+"]").length+1;if(t==-1||t>n){var r=$.extend({},this.item,{id:Berry.getUID(),name:this.name});this.owner.processField(r,$(e),this.parent,"after");this.owner.each(function(){this.createAttributes()});this.trigger("change")}},dropMe:function(){var e=this.self;var t=this.min||1;var n=$(e).siblings("[name="+this.name+"]").length;if(t<=n){$(e).empty().remove();var r=0;this.trigger("dropped");var i=this.owner.find(this.getPath());for(var s in i){i[s].instance_id=r++}this.trigger("change")}}});Berry.field.extend=function(e){var t=this;var n=function(){return t.apply(this,arguments)};var r=function(){this.constructor=n};r.prototype=t.prototype;n.prototype=new r;if(e)$.extend(n.prototype,e);return n};Berry.types={};Berry.register=function(e){Berry.types[e.type]=Berry.field.extend(e)};Berry.register({type:"fieldset",getValue:function(){return null},create:function(){this.name=this.name||Berry.getUID();if(!this.isChild()){++this.owner.section_count;this.owner.sections.push(this);this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend,state:"disabled",completed:false,active:false,error:false})}this.owner.fieldsets.push($('[name="'+this.name+'"]')[0]);return this.owner.renderer.fieldset(this)},focus:function(){this.owner.each(function(){this.focus();return false},{},this.children);return false},setValue:function(e){return true},setup:function(){if(this.fields!==undefined){this.owner.processfields(this.fields,this.self,this)}},isContainer:true});Berry.processConditions=function(e,t){if(typeof e==="string"){if(e==="show"||e==="display"){e=this.item.display||this.item.show}else if(e==="enable"){e=this.item.enable}}if(typeof e==="bool"){return e}if(typeof e==="object"){var n=[];for(var r in e){n.push(Berry.conditions[r].call(this,this.owner,e[r],t))}return n}return true};Berry.conditions={requires:function(e,t,n){return e.on("change:"+t.name,$.proxy(function(e,t,r,i){n.call(this,t.value!==null&&t.value!=="",i)},this,t)).lastToken},not_matches:function(e,t,n){return e.on("change:"+t.name,$.proxy(function(e,t,r,i){n.call(this,e.value!==t.value,i)},this,t)).lastToken},matches:function(e,t,n){return e.on("change:"+t.name,$.proxy(function(e,t,r,i){n.call(this,e.value===t.value,i)},this,t)).lastToken}};$(function(e){e.fn.berry=function(e){return new Berry(e,this)}}(jQuery));Berry.render=function(e,t){return(templates[e]||templates["berry_text"]).render(t,templates)};Berry.renderers={base:function(e){this.owner=e;this.initialize=function(){$(this.owner.$el).keydown(function(e){switch(e.keyCode){case 27:$("#close").click();break;case 13:if(e.ctrlKey){$("#submit").click()}break}})};this.fieldset=function(e){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",e)};this.destroy=function(){$(this.owner.$el).off();this.owner.$el.empty()};this.render=function(){this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options));return this.owner.$el.find("form")}}};Berry.collections={};Berry.processOpts=function(e){if(typeof e.choices==="function"){return e.choices.call(this)}if(typeof e.max!=="undefined"){e.min=e.min||0;e.step=e.step||1;e.choices=e.choices||[];if(e.min<=e.max){var t=e.min;while(t<=e.max){e.choices.push(t.toString());t+=e.step}}}if(typeof e.choices!=="undefined"&&e.choices.length>0){if(typeof e.choices==="string"){if(typeof Berry.collections[e.choices]==="undefined"){$.ajax({url:e.choices,type:"get",success:$.proxy(function(t){Berry.collections[e.choices]=t;this.update({choices:t})},e)});e.options=[];return e}else{e.choices=Berry.collections[e.choices]}}if(typeof e.choices==="object"&&!$.isArray(e.choices)){e.choices=e.choices.toJSON()}if(typeof e.default!=="undefined"){e.choices.unshift(e.default)}e.options=$.map(e.choices,function(e,t){return[e]})}if(typeof e.options!=="undefined"&&e.options.length>0){var n=false;for(var r in e.options){var i=e.options[r];if(typeof i==="string"||typeof i==="number"){i={label:i};if(e.key!=="index"){i.value=i.label}}e.options[r]=$.extend({label:i.name,value:r},{label:i[e.key||"title"],value:i[e.reference||"id"]},i);if(!n){if(typeof e.value!=="undefined"&&e.value!==""){e.options[r].selected=e.options[r].value==e.value}else{e.options[r].selected=true;e.value=e.options[r].value}n=e.options[r].selected}else{e.options[r].selected=false}}}return e};Berry.btn={save:{label:"Save",icon:"check",id:"submit",modifier:"success pull-right",click:function(){if(this.options.autoDestroy){this.on("saved",this.destroy)}this.trigger("save")}},cancel:{label:"Cancel",icon:"times",id:"close",modifier:"default pull-left",click:function(){if(this.options.autoDestroy){this.destroy()}this.trigger("cancel")}}};Berry.counter=0;Berry.getUID=function(){return"b"+Berry.counter++};Berry.prototype.sum=function(e){var t=this.toJSON(e);var n=0;if(typeof t==="object"){for(var r in t){n+=parseInt(t[r],10)||0}return n}return t};$.pluck=function(e,t){return $.map(e,function(e){return e[t]})};Berry.prototype.valid=true;Berry.prototype.validate=function(){this.toJSON();this.clearErrors();this.each(this.validateItem);return this.valid};Berry.prototype.validateItem=function(){this.owner.performValidate(this);this.owner.errors[this.item.name]=this.errors;if(this.owner.valid!==false){this.owner.valid=this.valid}};Berry.prototype.performValidate=function(e,t){var n=e.item;var r=e.value;if(typeof t!=="undefined"){r=t}e.valid=true;e.errors="";if(n.validate!==undefined&&typeof n.validate==="object"){for(var i in n.validate){if(!Berry.validations[i].method(r,n.validate[i])){if(n.show===undefined||e.owner.show(n.show)){e.valid=false;var s=Berry.validations[i].message;if(typeof n.validate[i]=="string"){s=n.validate[i]}e.errors=s.replace("{{label}}",n.label)}}e.self.toggleClass(e.owner.options.errorClass,!e.valid);e.self.find("."+e.owner.options.errorTextClass).html(e.errors)}}};Berry.prototype.errors={};Berry.prototype.clearErrors=function(){this.valid=true;this.errors={};this.$el.find("."+this.options.errorClass).removeClass(this.options.errorClass).find("."+this.options.errorTextClass).html("")};Berry.regex={};Berry.regex.numeric=/^[0-9]+$/;Berry.regex.integer=/^\-?[0-9]+$/;Berry.regex.decimal=/^\-?[0-9]*\.?[0-9]+$/;Berry.regex.email=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i;Berry.regex.alpha=/^[a-z]+$/i;Berry.regex.alphaNumeric=/^[a-z0-9]+$/i;Berry.regex.alphaDash=/^[a-z0-9_-]+$/i;Berry.regex.natural=/^[0-9]+$/i;Berry.regex.naturalNoZero=/^[1-9][0-9]*$/i;Berry.regex.ip=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i;Berry.regex.base64=/[^a-zA-Z0-9\/\+=]/i;Berry.regex.url=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;Berry.validations={required:{method:function(e,t){return e!==null&&e!==""},message:"The {{label}} field is required."},matches:{method:function(e,t){if(el==this.Berry[t]){return e===el.value}return false},message:"The {{label}} field does not match the %s field."},valid_email:{method:function(e){return Berry.regex.email.test(e)||e===""},message:"The {{label}} field must contain a valid email address."},valid_emails:{method:function(e){var t=e.split(",");for(var n=0;n<t.length;n++){if(!Berry.regex.email.test(t[n])){return false}}return true},message:"The {{label}} field must contain all valid email addresses."},min_length:{method:function(e,t){if(!Berry.regex.numeric.test(t)){return false}return e.length>=parseInt(t,10)},message:"The {{label}} field must be at least %s characters in length."},max_length:{method:function(e,t){if(!Berry.regex.numeric.test(t)){return false}return e.length<=parseInt(t,10)},message:"The {{label}} field must not exceed %s characters in length."},exact_length:{method:function(e,t){if(!Berry.regex.numericBerry.test(t)){return false}return e.length===parseInt(t,10)},message:"The {{label}} field must be exactly %s characters in length."},greater_than:{method:function(e,t){if(!decimalRegex.test(e)){return false}return parseFloat(e)>parseFloat(t)},message:"The {{label}} field must contain a number greater than %s."},less_than:{method:function(e,t){if(!decimalRegex.test(e)){return false}return parseFloat(e)<parseFloat(t)},message:"The {{label}} field must contain a number less than %s."},alpha:{method:function(e){return alphaRegex.test(e)||e===""},message:"The {{label}} field must only contain alphabetical characters."},alpha_numeric:{method:function(e){return alphaNumericRegex.test(e)||e===""},message:"The {{label}} field must only contain alpha-numeric characters."},alpha_dash:{method:function(e){return alphaDashRegex.test(e)||e===""},message:"The {{label}} field must only contain alpha-numeric characters, underscores, and dashes."},numeric:{method:function(e){return decimalRegex.test(e)||e===""},message:"The {{label}} field must contain only numbers."},integer:{method:function(e){return Berry.regex.integer.test(e)||e===""},message:"The {{label}} field must contain an integer."},decimal:{method:function(e){return decimalRegex.test(e)||e===""},message:"The {{label}} field must contain a decimal number."},is_natural:{method:function(e){return naturalRegex.test(e)||e===""},message:"The {{label}} field must contain only positive numbers."},is_natural_no_zero:{method:function(e){return naturalNoZeroRegex.test(e)||e===""},message:"The {{label}} field must contain a number greater than zero."},valid_ip:{method:function(e){return ipRegex.test(e)||e===""},message:"The {{label}} field must contain a valid IP."},valid_url:{method:function(e){return urlRegex.test(e)||e===""},message:"The {{label}} field must contain a valid Url."},valid_base64:{method:function(e){return base64Regex.test(e)||e===""},message:"The {{label}} field must contain a base64 string."}};(function(e,t){e.register({type:"text"});e.register({type:"password"});e.register({type:"hidden",render:function(){return'<input type="hidden"  name="'+this.name+'" value="'+this.value+'" />'}});e.register({type:"url",defaults:{post:'<i class="fa fa-link"></i>',validate:{valid_url:true}}});e.register({type:"phone",defaults:{mask:"(999) 999-9999",post:'<i class="fa fa-phone"></i>',placeholder:"+1"}});e.register({type:"email",defaults:{post:'<i class="fa fa-envelope"></i>',validate:{valid_email:true}}});e.register({type:"number",defaults:{elType:"text"},getValue:function(){var e=this.$el.val();if(t.isNumeric(e)){return parseFloat(e,10)}else{if(e===""){return e}this.revert();return 0}}});e.register({type:"tags",defaults:{elType:"text"},setup:function(){this.$el=this.self.find("input");this.$el.off();if(this.onchange!==undefined){this.$el.on("input",this.onchange)}this.$el.on("input",t.proxy(function(){this.trigger("change")},this));if(t.fn.tagsInput){this.$el.tagsInput()}},setValue:function(e){if(typeof this.lastSaved==="undefined"){this.lastSaved=e}this.value=e;this.$el.importTags(e);return this.$el.val(e)}})})(Berry,jQuery);Berry.register({type:"textarea","default":{autosize:true,advanced:false},setup:function(){this.$el=this.self.find("textarea");this.$el.off();if(this.onchange!==undefined){this.$el.on("input",this.onchange)}this.$el.on("input",$.proxy(function(){this.trigger("change")},this));if(this.item.advanced&&$.fn.htmlarea){this.$el.css({height:"300px"}).htmlarea({toolbar:this.item.toolbar||[["bold","italic","underline"],["superscript","subscript"],["justifyleft","justifycenter","justifyright"],["indent","outdent"],["orderedList","unorderedList"],["link","unlink"],["horizontalrule"]]});this.$el.on("change",$.proxy(function(){this.trigger("change")},this))}if(this.autosize!==false&&$.fn.autosize){this.$el.autosize()}},setValue:function(e){if(typeof this.lastSaved==="undefined"){this.lastSaved=e}this.value=e;this.$el.val(e);if(this.autosize!==false&&$.fn.autosize){this.$el.trigger("autosize.resize")}if(this.item.advanced&&$.fn.htmlarea){this.$el.htmlarea("updateHtmlArea",e)}return this.$el},focus:function(){this.$el.focus().val("").val(this.value);this.self.find("iframe").focus()}});(function(e,t){e.register({type:"radio",create:function(){return e.render("berry_radio",e.processOpts(this.item))},setup:function(){this.$el=this.self.find("[type=radio]");if(this.onchange!==undefined){this.$el.change(this.onchange)}this.$el.change(t.proxy(function(){this.trigger("change")},this))},getValue:function(){var e=this.self.find('[type="radio"]:checked').data("label");for(var t in this.item.options){if(this.item.options[t].label==e){return this.item.options[t].value}}},setValue:function(e){this.value=e;this.self.find('[value="'+this.value+'"]').prop("checked",true)},displayAs:function(){for(var e in this.item.options){if(this.item.options[e].value==this.lastSaved){return this.item.options[e].label}}},focus:function(){this.self.find('[type="radio"]:checked').focus()}})})(Berry,jQuery);(function(e,t){e.register({type:"checkbox",create:function(){this.checkStatus(this.value);return e.render("berry_checkbox",this)},checkStatus:function(e){if(e===true||e==="true"||e===1||e==="on"||e==this.truestate){this.value=true}else{this.value=false}},setup:function(){this.$el=this.self.find("[type=checkbox]");if(this.onchange!==undefined){this.$el.change(this.onchange)}this.$el.change(t.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.self.find('[type="checkbox"]').is(":checked")},setValue:function(e){this.checkStatus(e);this.self.find('[name="'+this.name+'"]').prop("checked",this.value)},displayAs:function(){for(var e in this.item.options){if(this.item.options[e].value==this.lastSaved){return this.item.options[e].name}}},focus:function(){this.self.find('[type="checkbox"]:checked').focus()}})})(Berry,jQuery);(function(e,t){e.register({type:"select",create:function(){return e.render("berry_select",e.processOpts(this))},setup:function(){this.$el=this.self.find("select");if(this.onchange!==undefined){this.$el.change(this.onchange)}this.$el.change(t.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.$el.children("option:selected").attr("value")},displayAs:function(){for(var e in this.options){if(this.options[e].value==this.lastSaved){return this.options[e].label}}}})})(Berry,jQuery);function containsKey(l,k){var r={};for(var j in k){if(typeof l[k[j]]!=='undefined'){r[k[j]]=l[k[j]];}}return r;}