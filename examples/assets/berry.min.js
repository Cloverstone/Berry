Berry=function(e,t){this.destroy=function(){this.trigger("destroy"),this.each(function(){"function"==typeof this.destroy&&this.destroy()}),this.$el.empty();for(var e=this.fieldsets.length-1;e>=0;e--)$(this.fieldsets[e]).empty();"function"==typeof this.renderer.destroy&&this.renderer.destroy(),delete Berry.instances[this.options.name],this.trigger("destroyed")},this.toJSON=function(e,t){return(t||!this.valid)&&this.validate(),"string"==typeof e&&e.length>0?this.find(e).getValue():a.call(this,this.parsefields(this.options))};var i=function(e,t){return this.each(function(e){if(this.multiple){var t=this.multiple.min||1;if("undefined"!=typeof e){var i=Berry.search(e,this.getPath()).length;i>t&&(t=i)}for(var s=!0;this.parent.children[this.name].instances.length<t&&s;)s=this.clone()}},[e],t),e};this.populate=function(e,t){this.each(function(e){if(!this.isContainer){var t=Berry.search(e,this.getPath());"undefined"!=typeof t&&"object"!=typeof t&&(this.setValue(t),this.trigger("change"),this.toJSON())}},[e],t)},this.each=function(e,t,i){i=i||this.fields;var s=!0;for(var n in i){if(s===!1)break;var r=i[n];r.item&&r.isActive()?s=e.apply(r,t):$.isEmptyObject(r.instances)||(s=this.each(e,t,r.instances)),$.isEmptyObject(r.children)||(s=this.each(e,t,r.children))}return s&&"undefined"!=typeof t?t:s},this.find=function(e,t){var i=[];return this.each(function(e,t){(this.getPath()==e||this.name==e)&&t.push(this)},[e,i],t),0==i.length?!1:i.length>1||i[0].multiple?i:i[0]},this.findByID=function(e,t){var i=[];return this.each(function(e,t){this.id==e&&t.push(this)},[e,i],t),i[0]},this.processfields=function(e,t,i){for(var n in e)var r=this.createField(s(e[n],n,this.options.default),t,i)};var s=function(e,t,i){if("string"==typeof e&&(e={type:e,label:t}),$.isArray(e)&&(e={options:e,label:t}),e=$.extend({},i,e),"undefined"!=typeof e.name&&0!==e.name.length||e.isContainer||(e.name="undefined"==typeof e.label||isNaN(parseFloat(t))?"undefined"!=typeof e.id?e.id:t.toLowerCase().split(" ").join("_"):e.label.toLowerCase().split(" ").join("_")),"undefined"==typeof e.label&&e.label!==!1&&(e.label=t),e.required?$.extend(e,{validate:{required:!0}}):"undefined"!=typeof e.validate&&(e.required=e.validate.required),"undefined"==typeof Berry.types[e.type])if("undefined"==typeof e.choices&&"undefined"==typeof e.options)e.type="undefined"==typeof e.fields?"text":"fieldset";else switch(e.options.length){case 2:e.falsestate=e.options[1].toLowerCase().split(" ").join("_");case 1:e.type="checkbox",e.truestate=e.options[0].toLowerCase().split(" ").join("_");break;case 3:case 4:e.type="radio";break;default:e.type="select"}return e};this.createField=function(e,t,i,s){void 0!==t[0]&&(t=t[0]);var r=n.call(this,e,i,t,s);if("undefined"==typeof r.fieldset&&(r.fieldset=t),"before"==s)$(t).before(r.render());else if("after"==s)$(t).after(r.render());else if("fieldset"!==r.type||r.isChild()||!this.sectionsEnabled){var a;if("undefined"!=typeof $(r.fieldset).children(".row").last().attr("id")&&(a=o[$(r.fieldset).children(".row").last().attr("id")]),"undefined"==typeof a||a.used+parseInt(r.columns,10)+parseInt(r.offset,10)>this.options.columns){var h=Berry.getUID();a={},a.used=0,a.ref=$(Berry.render("berry_row",{id:h})),o[h]=a,$(r.fieldset).append(a.ref)}a.used+=parseInt(r.columns,10),a.used+=parseInt(r.offset,10),a.ref.append($("<div/>").addClass("col-md-"+r.columns).addClass("col-md-offset-"+r.offset).append(r.render()))}else $(r.fieldset).append(r.render());return r.initialize(),r};var n=function(e,t,i){var s=new Berry.types[e.type](e,this);s.parent=t;var n=this.fields;null!==t&&void 0!==t&&(n=t.children);var r=void 0!==n[s.name];if(s.isContainer){r||(n[s.name]={isContainer:!0,multiple:s.multiple,hasChildren:!$.isEmptyObject(e.fields),instances:[]});var a=n[s.name].instances.length,h=$(i).attr("id");for(var o in n[s.name].instances)if(n[s.name].instances[o].id==h){a=parseInt(o,10)+1;break}n[s.name].instances.splice(a,0,s);var l=0;for(var d in n[s.name].instances)n[s.name].instances[d].instance_id=l++}else if(r||s.multiple){if(n[s.name].isContainer){var f=[];f.push(n[s.name]),f=n[s.name],n[s.name]={multiple:s.multiple,hasChildren:!$.isEmptyObject(e.fields),instances:[]},n[s.name].instances.push(f)}else if(n[s.name]instanceof Berry.field){var f=[];f.push(n[s.name]),f=n[s.name],n[s.name]={instances:[]},n[s.name].instances.push(f)}n[s.name].instances.push(s)}else n[s.name]=s;return s};this.parsefields=function(e){var t={};return this.each(function(e,t){if(this.isParsable){var i;if(i=!this.isChild()||t.flatten&&"undefined"==typeof this.parent.multiple?e:Berry.search(e,this.parent.getPath()),this.isContainer)this.multiple?i[this.name]=i[this.name]||[]:t.flatten||(i[this.name]={});else{var s=this.getValue();null===s&&(s=""),$.isArray(i)?(i[this.parent.instance_id]||(i[this.parent.instance_id]={}),i[this.parent.instance_id][this.name]=s):i[this.name]=s}}},[t,e]),t},this.setActions=function(e){if(this.options.actionTarget||(this.options.actionTarget=$('<div class="berry-actions" style="overflow:hidden;padding-bottom:10px"></div>'),this.target.append(this.options.actionTarget)),this.options.actionTarget.empty(),e){e=containsKey(Berry.btn,e);for(var t in e){var i=$(Berry.render("berry__action",e[t]));"function"==typeof e[t].click&&i.click($.proxy(e[t].click,this)),this.options.actionTarget.append(i)}}};var r=function(e){var t={};return this.each(function(e,t){var i;i=this.isContainer?this.multiple?e[this.name]||[]:{}:e[this.name],this.isChild()?this.parent.multiple||(Berry.search(t,this.parent.getPath())[this.name]=i):t[this.name]=i},[e,t]),t},a=function(e){var t=$.extend(!0,{},e);return this.each(function(e,t){if(this.multiple&&this.toArray){var i=e,s=Berry.search(i,this.getPath());this.isChild()&&(i=Berry.search(t,this.parent.getPath())),i[this.name]={};for(var n in this.children)i[this.name][n]=$.pluck(s,n)}},[e,t]),t},h=function(e){var t=$.extend(!0,{},e);return this.each(function(e,t){if(this.isContainer&&this.multiple&&this.toArray){for(var i=Berry.search(t,this.parent.getPath()),s=i[this.name],n=[],r=0;r>=0&&20>r;){for(var a in s){if(!(s[a].length>r)){r=-2;break}n[r]=n[r]||{},n[r][a]=s[a][r]}r++}i[this.name]=n}},[e,t]),t};this.load=function(e){"undefined"!=typeof e.attributes?"string"==typeof e.attributes?$.ajax({url:this.options.attributes,method:"GET",success:$.proxy(function(t){this.options.attributes=t,e=this.options,e.flatten&&(e.attributes=r.call(this,e.attributes)),this.populate(i.call(this,h.call(this,e.attributes)))},this)}):(e.flatten&&(e.attributes=r.call(this,e.attributes)),this.populate(i.call(this,h.call(this,e.attributes)))):i.call(this),this.each(function(){this.isContainer||this.trigger("change")}),e.autoFocus&&this.each(function(){return this.isContainer?void 0:(this.focus(),!1)}),this.trigger("loaded")},this.$el=t,this.section_count=0,this.sectionsEnabled=!1,this.sections=[],this.sectionList=[],this.initialized=!1;var o={};this.fieldsets=[],this.fields={},this.options=$.extend({name:Berry.getUID()},Berry.options,e),this.events=$.extend({},Berry.prototype.events),this.trigger("initialize"),"undefined"==typeof this.$el&&(this.$el=$("<div/>")),this.renderer=new Berry.renderers[this.options.renderer](this),this.target=this.renderer.render(),this.options.legend&&this.options.legendTarget&&this.options.legendTarget.append(this.options.legend),this.processfields(this.options.fields,this.target,null),this.setActions(this.options.actions),"function"==typeof this.renderer.initialize&&this.renderer.initialize(),this.load(this.options),"undefined"!=typeof Berry.instances[this.options.name]?(Berry.instances[this.options.name].on("destroyed",$.proxy(function(){Berry.instances[this.options.name]=this,this.initialized=!0,this.trigger("initialized")},this)),Berry.instances[this.options.name].destroy()):(Berry.instances[this.options.name]=this,this.initialized=!0,this.trigger("initialized"))}; Berry.processConditions=function(n,e){if("string"==typeof n&&("show"===n||"enabled"===n||"parsable"===n?n=this.item[n]:"enable"===n&&(n=this.item.enable)),"boolean"==typeof n)return n;if("object"==typeof n){var t=[];for(var o in n)t.push(Berry.conditions[o].call(this,this.owner,n[o],e||n[o].callBack));return t}return!0},Berry.conditions={requires:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,a){t.call(this,null!==e.value&&""!==e.value,a)},this,e)).lastToken},not_matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,a){t.call(this,n.value!==e.value,a)},this,e)).lastToken},matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,a){t.call(this,n.value===e.value,a)},this,e)).lastToken}}; function containsKey(e,t){var i={};for(var n in t)"undefined"!=typeof e[t[n]]&&(i[t[n]]=e[t[n]]);return i}Berries=Berry.instances={},Berry.counter=0,Berry.types={},Berry.collections={},Berry.options={errorClass:"has-error",errorTextClass:"font-xs.text-danger",inline:!1,modifiers:"",renderer:"base",flatten:!0,columns:12,autoDestroy:!1,autoFocus:!0,actions:["cancel","save"]},Berry.register=function(e){Berry.types[e.type]=e.extends&&"undefined"!=typeof Berry.types[e.extends]?Berry.types[e.extends].extend(e):Berry.field.extend(e)},Berry.search=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1");for(var i=t.split(".");i.length;){var n=i.shift();"undefined"!=typeof e&&n in e&&(e=e[n])}return e},Berry.processOpts=function(e,t){if("undefined"!=typeof e.max&&(e.min=e.min||0,e.choices=e.choices||[],0!=e.step&&e.min<=e.max))for(var i=e.min;i<=e.max;i+=e.step||1)e.choices.push(i.toString());if("function"==typeof e.choices&&(e.options=e.choices.call(this,e)),"undefined"!=typeof e.choices&&e.choices.length>0){if("string"==typeof e.choices){if("undefined"==typeof Berry.collections[e.choices])return $.ajax({url:e.choices,type:"get",success:$.proxy(function(t){Berry.collections[e.choices]=t,this.update({choices:t,value:Berry.search(this.owner.attributes,this.getPath())})},t)}),e.options=[],e;e.choices=Berry.collections[e.choices]}if("object"==typeof e.choices&&!$.isArray(e.choices))for(var n in conditions)Berry.conditions[n].call(this,this.owner,conditions[n],function(){});"undefined"!=typeof e.default&&e.choices.unshift(e.default),e.options=$.map(e.choices,function(e){return[e]})}if("undefined"!=typeof e.options&&e.options.length>0){for(var r in e.options){var s=e.options[r];("string"==typeof s||"number"==typeof s)&&(s={label:s},"index"!==e.label_key&&(s.value=s.label)),e.options[r]=$.extend({label:s.name,value:r},{label:s[e.label_key||"title"],value:s[e.value_key||"id"]},s),"undefined"!=typeof e.value&&""!==e.value&&(e.options[r].selected=$.isArray(e.value)?$.inArray(e.options[r].value,e.value)>-1:e.options[r].value==e.value)}}return e},Berry.getUID=function(){return"b"+Berry.counter++},Berry.render=function(e,t){return(templates[e]||templates.berry_text).render(t,templates)},Berry.register({type:"fieldset",getValue:function(){return null},create:function(){return this.name=this.name||Berry.getUID(),"undefined"!=typeof this.multiple&&(this.multiple.min=this.multiple.min||1,"undefined"!=typeof this.multiple.max&&(this.multiple.max>this.multiple.min?this.multiple.duplicate=!0:this.multiple.min>this.multiple.max&&(this.multiple.min=this.multiple.max))),this.isChild()||(++this.owner.section_count,this.owner.sections.push(this),this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend,state:"disabled",completed:!1,active:!1,error:!1})),this.owner.fieldsets.push($('[name="'+this.name+'"]')[0]),this.owner.renderer.fieldset(this)},focus:function(){return this.owner.each(function(){return this.focus(),!1},{},this.children),!1},setValue:function(){return!0},setup:function(){return void 0!==this.fields?this.owner.processfields(this.fields,this.self,this):void 0},isContainer:!0}),Berry.renderers={base:function(e){this.owner=e,this.initialize=function(){$(this.owner.$el).keydown($.proxy(function(e){switch(e.keyCode){case 27:$("#close").click();break;case 13:e.ctrlKey&&this.owner.$el.find("[data-id=berry-submit]").click()}},this))},this.fieldset=function(e){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",e)},this.destroy=function(){$(this.owner.$el).off(),this.owner.$el.empty()},this.render=function(){return this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options)),this.owner.$el.find("form")}}},Berry.btn={save:{label:"Save",icon:"check",id:"berry-submit",modifier:"success pull-right",click:function(){this.options.autoDestroy&&this.on("saved",this.destroy),this.trigger("save")}},cancel:{label:"Cancel",icon:"times",id:"berry-close",modifier:"default pull-left",click:function(){this.options.autoDestroy&&this.destroy(),this.trigger("cancel")}}},Berry.prototype.events.save=[{token:Berry.getUID(),func:function(){"string"==typeof this.options.action&&$.ajax({url:this.options.action,data:this.toJSON(),method:this.options.method||"POST",success:$.proxy(function(){this.trigger("saved")},this)})}}],Berry.prototype.sum=function(e){var t=this.toJSON(e),i=0;if("object"==typeof t){for(var n in t)i+=parseInt(t[n],10)||0;return i}return t},$(function(e){e.fn.berry=function(e){return new Berry(e,this)}}(jQuery)),$.pluck=function(e,t){return $.map(e,function(e){return e[t]})}; Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){Berry.field.prototype.clone=function(){var e=this.multiple.max;if("undefined"==typeof e||e>this.parent.children[this.name].instances.length){{$.extend({},this.owner.options.default,this.item,{id:Berry.getUID(),name:this.name})}return this.owner.createField($.extend({},this.owner.options.default,this.item,{id:Berry.getUID(),name:this.name}),$(this.self),this.parent,"after"),this.trigger("change"),!0}return!1},Berry.field.prototype.remove=function(){if((this.multiple.min||1)<this.parent.children[this.name].instances.length){$(this.self).empty().remove(),this.trigger("dropped");var e=this.owner.fields;this.isChild()&&(e=this.parent.children),e[this.name].instances.splice(this.instance_id,1);var i=0,t=this.owner.find(this.getPath());for(var n in t)t[n].instance_id=i++;return this.trigger("change"),!0}return!1},this.on("initializedField",function(e){e.field.multiple&&e.field.multiple.duplicate&&(e.field.self.find(".duplicate").on("click",$.proxy(e.field.clone,e.field)),e.field.self.find(".remove").on("click",$.proxy(e.field.remove,e.field)))})}}); Berry.prototype.events={initialize:[]},Berry.prototype.addSub=function(t,e){this.events[t]||(this.events[t]=[]);var i=Berry.getUID();return this.events[t].push({token:i,func:e}),i},Berry.prototype.on=function(t,e,i,s){var n=/\s+/;if(n.test(t)){var r=t.split(n);for(var o in r)"undefined"!=typeof i?this.addSub(r[o],$.proxy(e,i)):this.addSub(r[o],e)}else this.lastToken="undefined"!=typeof i?this.addSub(t,$.proxy(e,i)):this.addSub(t,e);return s&&e.call(this,null,t),this},Berry.prototype.delay=function(t,e,i,s){var n=function(t,e,i){clearTimeout(this.events[i].timer),this.events[i].timer=setTimeout($.proxy(function(){this.events[i].func.call(this)},this),s||250)},r=/\s+/;if(r.test(t)){var o=t.split(r);for(var h in o)this.lastToken=this.addSub(o[h],n),this.events[this.lastToken]={func:e,timer:null}}else this.lastToken=this.addSub(t,n),this.events[this.lastToken]={func:e,timer:null};return i&&e.call(this,null,t),this},Berry.prototype.off=function(t){for(var e in this.events)if(this.events[e])for(var i=0,s=this.events[e].length;s>i;i++)if(this.events[e][i].token===t)return this.events[e].splice(i,1),t;return this},Berry.prototype.trigger=function(t,e){if(this.events[t])for(var i=this.events[t],s=i?i.length:0;s--;)i[s].func.call(this,e,t,i[s].token);if(newtopic=t.split(":")[0],newtopic!==t&&(t=newtopic,this.events[t]))for(var i=this.events[t],s=i?i.length:0;s--;)i[s].func.call(this,e,t,i[s].token);return this}; Berry.field=function(t,i){this.children={},this.owner=i,this.hidden=!1,this.item=$.extend(!0,{},this.defaults,t),this.owner.trigger("initializeField",{field:this}),$.extend(this,this.owner.options,this.item),0!==this.item.value?"function"==typeof t.value?(this.valueFunc=t.value,this.liveValue=function(){return this.valueFunc.call(this.owner.toJSON())},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):"string"==typeof this.item.value&&0===this.item.value.indexOf("=")&&"undefined"!=typeof math?(this.formula=this.item.value.substr(1),this.liveValue=function(){try{var t=math.eval(this.formula,this.owner.toJSON());return $.isNumeric(t)?t.toFixed(this.item.precision||0):t}catch(i){return this.formula}},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):this.value=t.value||this.value||t.default||"":this.value=0,this.lastSaved=this.liveValue(),this.id=t.id||Berry.getUID(),this.self=void 0,this.fieldset=void 0,"object"!=typeof this.item.fieldset?void 0!==this.item.fieldset&&$("."+this.item.fieldset).length>0?(this.fieldset=$("."+this.item.fieldset)[0],this.owner.fieldsets.push(this.fieldset)):void 0!==this.item.fieldset&&$("[name="+this.item.fieldset+"]").length>0&&(this.fieldset=$("[name="+this.item.fieldset+"]")[0],this.owner.fieldsets.push(this.fieldset)):this.item.fieldset.length&&(this.fieldset=this.item.fieldset),this.val=function(t){return"undefined"!=typeof t&&this.set(t),this.getValue()},this.columns=this.columns||this.owner.options.columns,this.columns>this.owner.options.columns&&(this.columns=this.owner.options.columns)},$.extend(Berry.field.prototype,{type:"text",offset:0,version:"1.0",isContainer:!1,isParsable:!0,isVisible:!0,isEnabled:!0,instance_id:null,path:"",defaults:{},parent:null,getPath:function(t){var i="";return null!==this.parent&&void 0!==this.parent&&(i=this.parent.getPath(t)+".",(this.parent.multiple||t)&&(i+=this.parent.instance_id+".")),i+this.name},isActive:function(){return null===this.parent||this.parent.isEnabled!==!1},isChild:function(){return null!==this.parent},set:function(t){this.value!=t&&(this.setValue(t),this.trigger("change"))},revert:function(){return this.item.value=this.lastSaved,this.setValue(this.lastSaved),this},hasChildren:function(){return!$.isEmptyObject(this.children)},create:function(){return Berry.render("berry_"+(this.elType||this.type),this)},render:function(){return"undefined"==typeof this.self?this.self=$(this.create()).attr("data-Berry",this.owner.options.name):this.self.html($(this.create()).html()),this.display=this.getDisplay(),this.self},getValue:function(){return this.$el.val()},toJSON:function(){return this.value=this.getValue(),this.lastSaved=this.value,this.display=this.getDisplay(),this.lastSaved},liveValue:function(){return this.value},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.mask&&$.fn.mask&&this.$el.mask(this.item.mask)},initialize:function(){this.setup(),"undefined"!=typeof this.show&&(this.isVisible=!0,this.showConditions=Berry.processConditions.call(this,this.show,function(t,i){this.showConditions[i]=t,this.self.show(),this.isVisible=!0;for(var e in this.showConditions)if(!this.showConditions[e]){this.isVisible=!1,this.self.hide();break}}),"boolean"==typeof this.showConditions&&(this.self.toggle(this.showConditions),this.isVisible=this.showConditions)),"undefined"!=typeof this.enabled&&(this.enabledConditions=Berry.processConditions.call(this,this.enabled,function(t,i){this.enabledConditions[i]=t,this.isEnabled=!0,this.enable();for(var e in this.enabledConditions)if(!this.enabledConditions[e]){this.isEnabled=!1,this.disable();break}})),"undefined"!=typeof this.parsable&&(this.parsableConditions=Berry.processConditions.call(this,this.parsable,function(t,i){this.parsableConditions[i]=t,this.isParsable=!0;for(var e in this.parsableConditions)if(!this.parsableConditions[e]){this.isParsable=!1;break}})),this.owner.trigger("initializedField",{field:this})},on:function(t,i){this.owner.on(t+":"+this.name,i)},delay:function(t,i){this.owner.delay(t+":"+this.name,i)},trigger:function(t){this.value=this.getValue(),this.owner.trigger(t+":"+this.name,{id:this.id,value:this.value})},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t)},update:function(t,i){"object"==typeof t&&$.extend(this.item,t),$.extend(this,this.item),this.setValue(this.value),this.render(),this.setup(),i||this.trigger("change")},blur:function(){this.$el.blur()},focus:function(){this.$el.focus().val("").val(this.value)},disable:function(){this.$el.prop("disabled",!0)},enable:function(){this.$el.prop("disabled",!1)},displayAs:function(){return this.lastSaved},getDisplay:function(){return void 0!==this.displayAs?void 0!==this.item.template?(this.display=this.displayAs(),Berry.render(this.item.template,this)):this.displayAs()||this.item.default||"Empty":void 0!==this.item.template?Berry.render(this.item.template,this):this.lastSaved||this.item.default||"Empty"},destroy:function(){this.$el&&this.$el.off()}}),Berry.field.extend=function(t){var i=this,e=function(){return i.apply(this,arguments)},s=function(){this.constructor=e};return s.prototype=i.prototype,e.prototype=new s,t&&$.extend(e.prototype,t),e}; Berry.prototype.valid=!0,Berry.prototype.validate=function(){return this.toJSON(),this.parsefields(this.options),this.clearErrors(),this.each(this.validateItem),this.valid},Berry.prototype.validateItem=function(){this.owner.performValidate(this),this.owner.errors[this.item.name]=this.errors,this.owner.valid=this.valid&&this.owner.valid},Berry.prototype.performValidate=function(e,t){var r=e.item,a=e.value;if("undefined"!=typeof t&&(a=t),e.valid=!0,e.errors="","undefined"!=typeof r.validate&&"object"==typeof r.validate)for(var i in r.validate){if(!Berry.validations[i].method(a,r.validate[i])&&("undefined"==typeof r.show||e.owner.isVisible)){e.valid=!1;var s=Berry.validations[i].message;"string"==typeof r.validate[i]&&(s=r.validate[i]),e.errors=s.replace("{{label}}",r.label)}e.self.toggleClass(e.owner.options.errorClass,!e.valid),e.self.find("."+e.owner.options.errorTextClass).html(e.errors)}},Berry.prototype.errors={},Berry.prototype.clearErrors=function(){this.valid=!0,this.errors={},this.$el.find("."+this.options.errorClass).removeClass(this.options.errorClass).find("."+this.options.errorTextClass).html("")},Berry.regex={},Berry.regex.numeric=/^[0-9]+$/,Berry.regex.integer=/^\-?[0-9]+$/,Berry.regex.decimal=/^\-?[0-9]*\.?[0-9]+$/,Berry.regex.email=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,Berry.regex.alpha=/^[a-z]+$/i,Berry.regex.alphaNumeric=/^[a-z0-9]+$/i,Berry.regex.alphaDash=/^[a-z0-9_-]+$/i,Berry.regex.natural=/^[0-9]+$/i,Berry.regex.naturalNoZero=/^[1-9][0-9]*$/i,Berry.regex.ip=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,Berry.regex.base64=/[^a-zA-Z0-9\/\+=]/i,Berry.regex.url=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,Berry.validations={required:{method:function(e){return null!==e&&""!==e},message:"The {{label}} field is required."},matches:{method:function(e,t){return el==this.Berry[t]?e===el.value:!1},message:"The {{label}} field does not match the %s field."},valid_email:{method:function(e){return Berry.regex.email.test(e)||""===e},message:"The {{label}} field must contain a valid email address."},valid_emails:{method:function(e){for(var t=e.split(","),r=0;r<t.length;r++)if(!Berry.regex.email.test(t[r]))return!1;return!0},message:"The {{label}} field must contain all valid email addresses."},min_length:{method:function(e,t){return Berry.regex.numeric.test(t)?e.length>=parseInt(t,10):!1},message:"The {{label}} field must be at least %s characters in length."},max_length:{method:function(e,t){return Berry.regex.numeric.test(t)?e.length<=parseInt(t,10):!1},message:"The {{label}} field must not exceed %s characters in length."},exact_length:{method:function(e,t){return Berry.regex.numericBerry.test(t)?e.length===parseInt(t,10):!1},message:"The {{label}} field must be exactly %s characters in length."},greater_than:{method:function(e,t){return decimalRegex.test(e)?parseFloat(e)>parseFloat(t):!1},message:"The {{label}} field must contain a number greater than %s."},less_than:{method:function(e,t){return decimalRegex.test(e)?parseFloat(e)<parseFloat(t):!1},message:"The {{label}} field must contain a number less than %s."},alpha:{method:function(e){return alphaRegex.test(e)||""===e},message:"The {{label}} field must only contain alphabetical characters."},alpha_numeric:{method:function(e){return alphaNumericRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters."},alpha_dash:{method:function(e){return alphaDashRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters, underscores, and dashes."},numeric:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain only numbers."},integer:{method:function(e){return Berry.regex.integer.test(e)||""===e},message:"The {{label}} field must contain an integer."},decimal:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain a decimal number."},is_natural:{method:function(e){return naturalRegex.test(e)||""===e},message:"The {{label}} field must contain only positive numbers."},is_natural_no_zero:{method:function(e){return naturalNoZeroRegex.test(e)||""===e},message:"The {{label}} field must contain a number greater than zero."},valid_ip:{method:function(e){return ipRegex.test(e)||""===e},message:"The {{label}} field must contain a valid IP."},valid_url:{method:function(e){return urlRegex.test(e)||""===e},message:"The {{label}} field must contain a valid Url."},valid_base64:{method:function(e){return base64Regex.test(e)||""===e},message:"The {{label}} field must contain a base64 string."}}; !function(t,e){t.register({type:"checkbox",defaults:{container:"span"},create:function(){return this.checkStatus(this.value),t.render("berry_checkbox",this)},checkStatus:function(t){this.value=t===!0||"true"===t||1===t||"1"===t||"on"===t||t==this.truestate?!0:!1},setup:function(){this.$el=this.self.find("[type=checkbox]"),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(e.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.$el.is(":checked")?this.truestate||!0:this.falsestate||!1},setValue:function(t){this.checkStatus(t),this.$el.prop("checked",this.value),this.value=t},displayAs:function(){for(var t in this.item.options)if(this.item.options[t].value==this.lastSaved)return this.item.options[t].name},focus:function(){this.$el.focus()}})}(Berry,jQuery); !function(t,i){t.register({type:"radio",create:function(){return this.options=t.processOpts.call(this.owner,this.item,this).options,t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find("[type=radio]"),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(i.proxy(function(){this.trigger("change")},this))},getValue:function(){var t=this.self.find('[type="radio"]:checked').data("label");for(var i in this.item.options)if(this.item.options[i].label==t)return this.item.options[i].value},setValue:function(t){this.value=t,this.self.find('[value="'+this.value+'"]').prop("checked",!0)},displayAs:function(){for(var t in this.item.options)if(this.item.options[t].value==this.lastSaved)return this.item.options[t].label},focus:function(){this.self.find('[type="radio"]:checked').focus()}})}(Berry,jQuery); !function(t,e){t.register({type:"select",create:function(){return this.options=t.processOpts.call(this.owner,this.item,this).options,t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find("select"),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(e.proxy(function(){this.trigger("change")},this))},displayAs:function(){var t=this.options;for(var e in t)if(t[e].value==this.lastSaved)return t[e].label}})}(Berry,jQuery); !function(e,t){e.register({type:"text"}),e.register({type:"raw"}),e.register({type:"password"}),e.register({type:"date"}),e.register({type:"range"}),e.register({type:"hidden",create:function(){return'<div><input type="hidden"  name="'+this.name+'" value="'+this.value+'" /></div>'}}),e.register({type:"url",defaults:{post:'<i class="fa fa-link"></i>',validate:{valid_url:!0}}}),e.register({type:"phone",defaults:{mask:"(999) 999-9999",post:'<i class="fa fa-phone"></i>',placeholder:"+1"}}),e.register({type:"color",defaults:{pre:"<i></i>",type:"text"},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.parent().colorpicker("setValue",this.value),this.$el.val(e)},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),this.$el.attr("type","text"),this.$el.parent().colorpicker({format:"hex"}).on("changeColor",t.proxy(function(){this.trigger("change")},this))}}),e.register({type:"email",defaults:{post:'<i class="fa fa-envelope"></i>',validate:{valid_email:!0}}}),e.register({type:"number",defaults:{elType:"text"},value:0,getValue:function(){var e=this.$el.val();return""===e?0:t.isNumeric(e)?parseFloat(e,10):void 0}}),e.register({type:"tags",defaults:{elType:"text"},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),t.fn.tagsInput&&this.$el.tagsInput()},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.importTags(e),this.$el.val(e)}})}(Berry,jQuery); !function(t,e){t.register({type:"textarea","default":{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("textarea"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",e.proxy(function(){this.trigger("change")},this)),this.item.advanced&&e.fn.htmlarea&&(this.$el.css({height:"300px"}).htmlarea({toolbar:this.item.toolbar||[["bold","italic","underline"],["superscript","subscript"],["justifyleft","justifycenter","justifyright"],["indent","outdent"],["orderedList","unorderedList"],["link","unlink"],["horizontalrule"]]}),this.$el.on("change",e.proxy(function(){this.trigger("change")},this))),this.autosize!==!1&&e.fn.autosize&&this.$el.autosize()},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t),this.autosize!==!1&&e.fn.autosize&&this.$el.trigger("autosize.resize"),this.item.advanced&&e.fn.htmlarea&&this.$el.htmlarea("updateHtmlArea",t),this.$el},focus:function(){this.$el.focus().val("").val(this.value),this.self.find("iframe").focus()}})}(Berry,jQuery);
