Berry=function(e,t){this.destroy=function(){this.trigger("destroy"),this.each(function(){"function"==typeof this.destroy&&this.destroy()}),this.$el.empty();for(var e in this.fieldsets)$(this.fieldsets[e]).empty();this.fields={},"function"==typeof this.renderer.destroy&&this.renderer.destroy(),delete Berry.instances[this.options.name],this.trigger("destroyed")},this.toJSON=function(e,t){if(t&&this.validate(),"string"==typeof e)return this.find(e).getValue();var s=i(h(this.attributes));if(this.options.flatten){var n=[];this.each(r,[s,n,a]),s=a(s)}return s},this.populate=function(e){e=e||this.fields,this.each(function(){if(this.multiple){var e={};if(e=Berry.search(this.owner.attributes,this.getPath())){var t=!0;for(var i in e)t?t=!1:this.owner.processField($.extend(!0,{},this.item,{id:Berry.getUID(),name:this.name}),$(this.self),this.parent,"after")}}},[],e),f.each(function(){if(!this.isContainer){var e=Berry.search(this.owner.attributes,this.getPath()),t=e;void 0===typeof t&&(t=""),this.setValue(t),this.trigger("change"),this.toJSON()}},[],e)};var i=function(e){var t=$.extend(!0,{},e);return f.each(function(e,t){if(this.multiple&&this.toArray){var i=e,s=Berry.search(i,this.getPath());this.isChild()&&(i=Berry.search(t,this.parent.getPath())),i[this.name]={};for(var n in this.children)i[this.name][n]=$.pluck(s,n)}},[e,t]),t},s=function(){return f.each(function(){if(this.multiple&&this.toArray){var e=this.owner.attributes[this.name];if(this.isChild()&&(e=Berry.search(this.owner.attributes,this.getPath(!0))),e){var t=$.extend(!0,{},e[this.name]);e[this.name]=[];var i=this.owner.source;this.isChild()&&(i=Berry.search(this.owner.source,this.parent.getPath()));for(var s in i[this.name]){for(var n in i[this.name][s]){var r=$.extend({},t);for(var a in t)r[a]=i[this.name][a][n];e[this.name].push(r)}break}}}else null!==this.owner.source[this.name]&&(this.owner.attributes[this.name]="object"==typeof this.owner.source[this.name]?$.isArray(this.owner.source[this.name])?$.extend([],this.owner.source[this.name]):$.extend({},this.owner.source[this.name]):this.owner.source[this.name])}),f.attributes},n=function(e,t){for(var i in t)"object"!=typeof t[i]||$.isArray(t[i])?i in e&&(t[i]=e[i]):t[i]=i in e?n(e[i],t[i]):n(e,t[i]);return t},r=function(e,t,i){if(this.isContainer&&this.owner.options.flatten&&(null===this.instance_id||0===this.instance_id))if(this.isChild()){for(var s=this.parent.getPath().split("."),n=[],r=s.length-1;r>=0;r--){var a=s[r];-1===s.indexOf(a)&&n.push(a)}s=n;var o=s.pop(),h=s.join(".");s.length?Berry.search(e,h)[o]=i(Berry.search(e,this.getPath())):o?e[o]=i(Berry.search(e,this.getPath())):($.extend(e,i(Berry.search(e,this.name))),delete e[this.name]),t.push(this.name)}else t.push(this.name),$.extend(e,i(e[this.name])),delete e[this.name]},a=function(e){var t,i={};for(var s in e)if("object"==typeof e[s])if($.isArray(e[s])){i[s]=[];for(t in e[s])i[s].push(e[s][t])}else{i[s]={};for(t in e[s])i[s][t]=e[s][t]}else i[s]=e[s];return i};this.each=function(e,t,i){i=i||this.fields;var s=!0;for(var n in i){if(s===!1)break;var r=i[n];r.item?r.isActive()&&(s=e.apply(r,t)):$.isEmptyObject(r.instances)||(s=this.each(e,t,r.instances)),$.isEmptyObject(r.children)||(s=this.each(e,t,r.children))}return s?t:s},this.find=function(e,t){var i=[];return this.each(function(e,t){(this.getPath()==e||this.name==e)&&t.push(this)},[e,i],t||this.fields),i.length>1||i[0].multiple?i:i[0]},this.findByID=function(e,t){var i=[];return this.each(function(e,t){this.id==e&&t.push(this)},[e,i],t||this.fields),i[0]},this.processfields=function(e,t,i){for(var s in e)"string"==typeof e[s]&&(e[s]={type:e[s],label:s}),e[s]=$.extend({},f.options.default,e[s]),"undefined"!=typeof e[s].name||e[s].isContainer||(e[s].name="undefined"!=typeof e[s].id?e[s].id:s.toLowerCase().split(" ").join("_")),"undefined"==typeof e[s].label&&e[s].label!==!1&&(e[s].label=s),e[s].required&&$.extend(e[s],{validate:{required:!0}}),"undefined"!=typeof e[s].validate&&(e[s].required=e[s].validate.required),this.processField(e[s],t,i)},this.processField=function(e,t,i,s){if(field=$.extend({},f.options.default,e),void 0!==t[0]&&(t=t[0]),field.type in Berry.types){var n=o(field,i,t,s);if(void 0===n.fieldset&&(n.fieldset=t),"before"==s)$(t).before(n.render());else if("after"==s)$(t).after(n.render());else if("fieldset"!==n.item.type||n.isChild()||!this.sectionsEnabled){var r;if("undefined"!=typeof $(n.fieldset).children(".row").last().attr("id")&&(r=c[$(n.fieldset).children(".row").last().attr("id")]),"undefined"==typeof r||r.used+parseInt(n.columns,10)+parseInt(n.offset,10)>this.options.columns){var a=Berry.getUID();r={},r.used=0,r.ref=$(Berry.render("berry_row",{id:a})),c[a]=r,$(n.fieldset).append(r.ref)}r.used+=parseInt(n.columns,10),r.used+=parseInt(n.offset,10),r.ref.append($("<div/>").addClass("col-md-"+n.columns).addClass("col-md-offset-"+n.offset).append(n.render()))}else $(n.fieldset).append(n.render());return n.initialize(),n}return!1};var o=function(e,t,i){var s=new(Berry.types[e.type]||Berry.types.text)(e,f);s.parent=t;var n=f.fields;null!==t&&void 0!==t&&(n=t.children);var r=void 0!==n[s.name];if(s.isContainer){r||(n[s.name]={isContainer:!0,multiple:s.multiple,hasChildren:!$.isEmptyObject(e.fields),toArray:s.item.toArray||s.owner.options.flatten,instances:[]});var a=n[s.name].instances.length,o=$(i).attr("id");for(var h in n[s.name].instances)if(n[s.name].instances[h].id==o){a=parseInt(h,10)+1;break}n[s.name].instances.splice(a,0,s);var d=0;for(var c in n[s.name].instances)n[s.name].instances[c].instance_id=d++}else if(r||s.multiple){if(n[s.name].isContainer){if(!f.options.flatten){var l=[];l.push(n[s.name]),l=n[s.name],n[s.name]={multiple:s.multiple,hasChildren:!$.isEmptyObject(e.fields),instances:[]},n[s.name].instances.push(l)}}else if(n[s.name]instanceof Berry.field){var l=[];l.push(n[s.name]),l=n[s.name],n[s.name]={instances:[]},n[s.name].instances.push(l)}n[s.name].instances.push(s)}else n[s.name]=s;return s},h=function(e){var t=$.extend(!0,{},e);return f.each(function(e){if(!this.isContainer){var t;(this.isChild()||null!==this.instance_id)&&(t=Berry.search(e,this.parent.getPath())),"undefined"==typeof t&&(t=e),$.isArray(t)?t[this.parent.instance_id][this.name]=this.getValue():t[this.name]=this.getValue()}},[t]),t},d=function(e){if(e){f.options.actionTarget||(f.options.actionTarget=$('<div class="berry-actions" style="overflow:hidden;padding-bottom:10px"></div>'),f.target.append(f.options.actionTarget)),e=containsKey(Berry.btn,e);for(var t in e){var i=$(Berry.render("berry__action",e[t]));"function"==typeof e[t].click&&i.click($.proxy(e[t].click,f)),f.options.actionTarget.append(i)}}},f=this;this.$el=t,this.options=$.extend(!0,{name:Berry.getUID()},Berry.options,e),this.events=$.extend({},Berry.prototype.events),this.fieldsets=[];var c={};this.section_count=0,this.sectionsEnabled=!1,this.sections=[],this.sectionList=[],this.fields={},this.source={},this.attributes={},this.trigger("initialize"),"undefined"==typeof this.$el&&(t=$("<div/>")),this.renderer=new Berry.renderers[this.options.renderer](this),this.target=this.renderer.render(),this.options.legend&&this.options.legendTarget&&this.options.legendTarget.append(this.options.legend),this.processfields(this.options.fields,this.target,null),"undefined"!=typeof this.options.attributes&&("hash"===this.options.attributes&&(this.options.attributes=window.location.hash.replace("#","").split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e[t[0]]=t[1],e},{})),this.source=$.extend(!0,{},this.options.attributes),this.options.flatten&&(this.source=n($.extend(!0,{},this.source),$.extend(!0,{},i(this.attributes)))||{}),s(),this.populate()),d(this.options.actions),"function"==typeof this.renderer.initialize&&this.renderer.initialize(),this.options.autoFocus&&this.each(function(){return this.focus(),!1}),this.each(function(){this.trigger("change")}),Berry.instances[this.options.name]=this,this.on("dropped",function(e){var t=f.findByID(e.id);Berry.search(f.attributes,e.path).splice(t.instance_id,1),t.isChild()?t.parent.children[t.name].instances.splice(t.instance_id,1):f.fields[t.name].instances.splice(t.instance_id,1)})},Berries=Berry.instances={},Berry.types={},Berry.collections={},Berry.options={errorClass:"has-error",errorTextClass:"font-xs.text-danger",options:{inline:!1},modifiers:"",renderer:"base",flatten:!0,columns:12,autoDestroy:!1,autoFocus:!0,"default":{type:"text"},actions:["cancel","save"]},Berry.register=function(e){Berry.types[e.type]=e.extends&&"undefined"!=typeof Berry.types[e.extends]?Berry.types[e.extends].extend(e):Berry.field.extend(e)},Berry.search=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1");for(var i=t.split(".");i.length;){var s=i.shift();if(!("undefined"!=typeof e&&s in e))return e;e=e[s]}return e},$(function(e){e.fn.berry=function(e){return new Berry(e,this)}}(jQuery)); Berry.processConditions=function(n,e){if("string"==typeof n&&("show"===n||"display"===n?n=this.item.display||this.item.show:"enable"===n&&(n=this.item.enable)),"boolean"==typeof n)return n;if("object"==typeof n){var t=[];for(var i in n)t.push(Berry.conditions[i].call(this,this.owner,n[i],e||n[i].callBack));return t}return!0},Berry.conditions={requires:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,i,o){t.call(this,null!==e.value&&""!==e.value,o)},this,e)).lastToken},not_matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,i,o){t.call(this,n.value!==e.value,o)},this,e)).lastToken},matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,i,o){t.call(this,n.value===e.value,o)},this,e)).lastToken}}; Berry.prototype.events={initialize:[]},Berry.prototype.addSub=function(t,e){this.events[t]||(this.events[t]=[]);var s=Berry.getUID();return this.events[t].push({token:s,func:e}),s},Berry.prototype.on=function(t,e,s){var i=/\s+/;if(i.test(t)){var n=t.split(i);for(var r in n)this.addSub(n[r],e)}else this.lastToken=this.addSub(t,e);return s&&e.call(this,null,t),this},Berry.prototype.delay=function(t,e,s,i){var n=function(t,e,s){clearTimeout(this.events[s].timer),this.events[s].timer=setTimeout($.proxy(function(){this.events[s].func.call(this)},this),i||250)},r=/\s+/;if(r.test(t)){var o=t.split(r);for(var h in o)this.lastToken=this.addSub(o[h],n),this.events[this.lastToken]={func:e,timer:null}}else this.lastToken=this.addSub(t,n),this.events[this.lastToken]={func:e,timer:null};return s&&e.call(this,null,t),this},Berry.prototype.off=function(t){for(var e in this.events)if(this.events[e])for(var s=0,i=this.events[e].length;i>s;s++)if(this.events[e][s].token===t)return this.events[e].splice(s,1),t;return this},Berry.prototype.processTopic=function(t,e){if(this.events[t])for(var s=this.events[t],i=s?s.length:0;i--;)s[i].func.call(this,e,t,s[i].token)},Berry.prototype.trigger=function(t,e){if(this.events[t])for(var s=this.events[t],i=s?s.length:0;i--;)s[i].func.call(this,e,t,s[i].token);if(newtopic=t.split(":")[0],newtopic!==t&&(t=newtopic,this.events[t]))for(var s=this.events[t],i=s?s.length:0;i--;)s[i].func.call(this,e,t,s[i].token);return this}; Berry.field=function(t,e){this.children={},this.owner=e,this.hidden=!1,this.item=$.extend(!0,{},this.defaults,t),$.extend(this,this.owner.options.options,this.item),0!==t.value?"function"==typeof t.value?(this.valueFunc=t.value,this.liveValue=function(){return this.valueFunc.call(this.owner.toJSON())},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):"string"==typeof this.item.value&&0===this.item.value.indexOf("=")&&"undefined"!=typeof math?(this.liveValue=function(){try{var t=math.eval(this.item.value.substr(1),this.owner.toJSON());return $.isNumeric(t)?t.toFixed(this.item.precision||0):t}catch(e){return this.template.render()}},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):this.value=t.value||this.value||t.default||"":this.value=0,this.lastSaved=this.liveValue(),this.id=t.id||Berry.getUID(),this.self=void 0,this.fieldset=void 0,void 0!==this.item.fieldset&&$("."+this.item.fieldset).length>0?(this.fieldset=$("."+this.item.fieldset)[0],this.owner.fieldsets.push(this.fieldset)):void 0!==this.item.fieldset&&$("[name="+this.item.fieldset+"]").length>0&&(this.fieldset=$("[name="+this.item.fieldset+"]")[0],this.owner.fieldsets.push(this.fieldset)),this.val=function(t){return"undefined"!=typeof t&&this.set(t),this.getValue()},this.columns=this.columns||this.owner.options.columns,this.columns>this.owner.options.columns&&(this.columns=this.owner.options.columns)},$.extend(Berry.field.prototype,{type:"text",offset:0,version:"1.0",isContainer:!1,instance_id:null,path:"",defaults:{},parent:null,enabled:!0,getPath:function(t){var e="";return null!==this.parent&&void 0!==this.parent&&(e=this.parent.getPath(t)+".",(this.parent.multiple||t)&&(e+=this.parent.instance_id+".")),e+this.name},isActive:function(){return null===this.parent||this.parent.enabled!==!1},isChild:function(){return null!==this.parent},set:function(t){this.value!=t&&(this.setValue(t),this.trigger("change"))},revert:function(){this.item.value=this.lastSaved,this.setValue(this.lastSaved)},hasChildren:function(){return!$.isEmptyObject(this.children)},create:function(){return Berry.render("berry_"+(this.elType||this.type),this)},render:function(){return"undefined"==typeof this.self?this.self=$(this.create()).attr("data-Berry",this.owner.options.name):this.self.html($(this.create()).html()),this.display=this.getDisplay(),this.self},getValue:function(){return this.$el.val()},toJSON:function(){return this.value=this.getValue(),this.lastSaved=this.value,this.display=this.getDisplay(),this.lastSaved},liveValue:function(){return this.value},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.mask&&$.fn.mask&&this.$el.mask(this.item.mask)},createAttributes:function(){var t=this.owner.attributes;if(this.isContainer)this.multiple?(this.isChild()&&(t=Berry.search(t,this.parent.getPath())),t[this.name]=t[this.name]||[]):t[this.name]={};else{var e=this.getPath();e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,"");for(var i=e.split(".");i.length;){var s=i.shift();t=s in t?t[s]:t[s]=s==this.name?this.value:{}}}},initialize:function(){this.multiple&&this.multiple.duplicate&&(this.self.find(".duplicate").click($.proxy(this.dupeMe,this)),this.self.find(".remove").click($.proxy(this.dropMe,this))),this.createAttributes(),this.setup(),"undefined"!=typeof this.show&&(this.showConditions=Berry.processConditions.call(this,this.show,function(t,e){this.showConditions[e]=t,this.self.show();for(var i in this.showConditions)if(!this.showConditions[i]){this.self.hide();break}}),"boolean"==typeof this.showConditions&&this.self.toggle(this.showConditions)),"undefined"!=typeof this.enabled&&(this.enabledConditions=Berry.processConditions.call(this,this.enabled,function(t,e){this.enabledConditions[e]=t,this.enabledState=!0,this.enable();for(var i in this.enabledConditions)if(!this.enabledConditions[i]){this.enabledState=!1,this.disable();break}}))},on:function(t,e){this.owner.on(t+":"+this.name,e)},delay:function(t,e){this.owner.delay(t+":"+this.name,e)},trigger:function(t){this.value=this.getValue(),this.owner.trigger(t+":"+this.name,{type:this.type,name:this.name,id:this.id,value:this.value,path:this.getPath()})},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t)},update:function(t,e){$.extend(this.item,t),$.extend(this,this.item),this.setValue(this.value),this.render(),this.setup(),e||this.trigger("change")},blur:function(){this.$el.blur()},focus:function(){this.$el.focus().val("").val(this.value)},disable:function(){this.$el.prop("disabled",!0)},enable:function(){this.$el.prop("disabled",!1)},displayAs:function(){return this.lastSaved},getDisplay:function(){return void 0!==this.displayAs?void 0!==this.item.template?(this.display=this.displayAs(),Berry.render(this.item.template,this)):this.displayAs()||this.item.default||"Empty":void 0!==this.item.template?Berry.render(this.item.template,this):this.lastSaved||this.item.default||"Empty"},destroy:function(){this.$el&&this.$el.off()},dupeMe:function(){var t=this.self,e=this.max||-1,i=$(t).siblings("[name="+this.name+"]").length+1;if(-1==e||e>i){var s=$.extend({},this.item,{id:Berry.getUID(),name:this.name});this.owner.processField(s,$(t),this.parent,"after"),this.owner.each(function(){this.createAttributes()}),this.trigger("change")}},dropMe:function(){var t=this.self,e=this.min||1,i=$(t).siblings("[name="+this.name+"]").length;if(i>=e){$(t).empty().remove();var s=0;this.trigger("dropped");var n=this.owner.find(this.getPath());for(var h in n)n[h].instance_id=s++;this.trigger("change")}}}),Berry.field.extend=function(t){var e=this,i=function(){return e.apply(this,arguments)},s=function(){this.constructor=i};return s.prototype=e.prototype,i.prototype=new s,t&&$.extend(i.prototype,t),i},Berry.processOpts=function(t){if("undefined"!=typeof t.max&&(t.min=t.min||0,t.choices=t.choices||[],t.min<=t.max))for(var e=t.min;e<=t.max;e+=t.step||1)t.choices.push(e.toString());if("function"==typeof t.choices&&(t.choices=t.choices.call(t)),"undefined"!=typeof t.choices&&t.choices.length>0){if("string"==typeof t.choices){if("undefined"==typeof Berry.collections[t.choices])return $.ajax({url:t.choices,type:"get",success:$.proxy(function(e){Berry.collections[t.choices]=e,this.update({choices:e,value:Berry.search(this.owner.attributes,this.getPath())})},t)}),t.options=[],t;t.choices=Berry.collections[t.choices]}if("object"==typeof t.choices&&!$.isArray(t.choices))for(var i in conditions)Berry.conditions[i].call(this,this.owner,conditions[i],function(){});"undefined"!=typeof t.default&&t.choices.unshift(t.default),t.options=$.map(t.choices,function(t){return[t]})}if("undefined"!=typeof t.options&&t.options.length>0){var s=!1;for(var n in t.options){var h=t.options[n];("string"==typeof h||"number"==typeof h)&&(h={label:h},"index"!==t.key&&(h.value=h.label)),t.options[n]=$.extend({label:h.name,value:n},{label:h[t.key||"title"],value:h[t.reference||"id"]},h),s?t.options[n].selected=!1:("undefined"!=typeof t.value&&""!==t.value?t.options[n].selected=t.options[n].value==t.value:(t.options[n].selected=!0,t.value=t.options[n].value),s=t.options[n].selected)}}return t}; function containsKey(e,t){var r={};for(var i in t)"undefined"!=typeof e[t[i]]&&(r[t[i]]=e[t[i]]);return r}Berry.register({type:"fieldset",getValue:function(){return null},create:function(){return this.name=this.name||Berry.getUID(),this.isChild()||(++this.owner.section_count,this.owner.sections.push(this),this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend,state:"disabled",completed:!1,active:!1,error:!1})),this.owner.fieldsets.push($('[name="'+this.name+'"]')[0]),this.owner.renderer.fieldset(this)},focus:function(){return this.owner.each(function(){return this.focus(),!1},{},this.children),!1},setValue:function(){return!0},setup:function(){void 0!==this.fields&&this.owner.processfields(this.fields,this.self,this)},isContainer:!0}),Berry.render=function(e,t){return(templates[e]||templates.berry_text).render(t,templates)},Berry.renderers={base:function(e){this.owner=e,this.initialize=function(){$(this.owner.$el).keydown(function(e){switch(e.keyCode){case 27:$("#close").click();break;case 13:e.ctrlKey&&$("#submit").click()}})},this.fieldset=function(e){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",e)},this.destroy=function(){$(this.owner.$el).off(),this.owner.$el.empty()},this.render=function(){return this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options)),this.owner.$el.find("form")}}},Berry.btn={save:{label:"Save",icon:"check",id:"berry-submit",modifier:"success pull-right",click:function(){this.options.autoDestroy&&this.on("saved",this.destroy),this.trigger("save")}},cancel:{label:"Cancel",icon:"times",id:"berry-close",modifier:"default pull-left",click:function(){this.options.autoDestroy&&this.destroy(),this.trigger("cancel")}}},Berry.counter=0,Berry.getUID=function(){return"b"+Berry.counter++},Berry.prototype.sum=function(e){var t=this.toJSON(e),r=0;if("object"==typeof t){for(var i in t)r+=parseInt(t[i],10)||0;return r}return t},$.pluck=function(e,t){return $.map(e,function(e){return e[t]})}; Berry.prototype.valid=!0,Berry.prototype.validate=function(){return this.toJSON(),this.clearErrors(),this.each(this.validateItem),this.valid},Berry.prototype.validateItem=function(){this.owner.performValidate(this),this.owner.errors[this.item.name]=this.errors,this.owner.valid!==!1&&(this.owner.valid=this.valid)},Berry.prototype.performValidate=function(e,r){var t=e.item,a=e.value;if("undefined"!=typeof r&&(a=r),e.valid=!0,e.errors="",void 0!==t.validate&&"object"==typeof t.validate)for(var s in t.validate){if(!Berry.validations[s].method(a,t.validate[s])&&(void 0===t.show||e.owner.show(t.show))){e.valid=!1;var i=Berry.validations[s].message;"string"==typeof t.validate[s]&&(i=t.validate[s]),e.errors=i.replace("{{label}}",t.label)}e.self.toggleClass(e.owner.options.errorClass,!e.valid),e.self.find("."+e.owner.options.errorTextClass).html(e.errors)}},Berry.prototype.errors={},Berry.prototype.clearErrors=function(){this.valid=!0,this.errors={},this.$el.find("."+this.options.errorClass).removeClass(this.options.errorClass).find("."+this.options.errorTextClass).html("")},Berry.regex={},Berry.regex.numeric=/^[0-9]+$/,Berry.regex.integer=/^\-?[0-9]+$/,Berry.regex.decimal=/^\-?[0-9]*\.?[0-9]+$/,Berry.regex.email=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,Berry.regex.alpha=/^[a-z]+$/i,Berry.regex.alphaNumeric=/^[a-z0-9]+$/i,Berry.regex.alphaDash=/^[a-z0-9_-]+$/i,Berry.regex.natural=/^[0-9]+$/i,Berry.regex.naturalNoZero=/^[1-9][0-9]*$/i,Berry.regex.ip=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,Berry.regex.base64=/[^a-zA-Z0-9\/\+=]/i,Berry.regex.url=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,Berry.validations={required:{method:function(e){return null!==e&&""!==e},message:"The {{label}} field is required."},matches:{method:function(e,r){return el==this.Berry[r]?e===el.value:!1},message:"The {{label}} field does not match the %s field."},valid_email:{method:function(e){return Berry.regex.email.test(e)||""===e},message:"The {{label}} field must contain a valid email address."},valid_emails:{method:function(e){for(var r=e.split(","),t=0;t<r.length;t++)if(!Berry.regex.email.test(r[t]))return!1;return!0},message:"The {{label}} field must contain all valid email addresses."},min_length:{method:function(e,r){return Berry.regex.numeric.test(r)?e.length>=parseInt(r,10):!1},message:"The {{label}} field must be at least %s characters in length."},max_length:{method:function(e,r){return Berry.regex.numeric.test(r)?e.length<=parseInt(r,10):!1},message:"The {{label}} field must not exceed %s characters in length."},exact_length:{method:function(e,r){return Berry.regex.numericBerry.test(r)?e.length===parseInt(r,10):!1},message:"The {{label}} field must be exactly %s characters in length."},greater_than:{method:function(e,r){return decimalRegex.test(e)?parseFloat(e)>parseFloat(r):!1},message:"The {{label}} field must contain a number greater than %s."},less_than:{method:function(e,r){return decimalRegex.test(e)?parseFloat(e)<parseFloat(r):!1},message:"The {{label}} field must contain a number less than %s."},alpha:{method:function(e){return alphaRegex.test(e)||""===e},message:"The {{label}} field must only contain alphabetical characters."},alpha_numeric:{method:function(e){return alphaNumericRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters."},alpha_dash:{method:function(e){return alphaDashRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters, underscores, and dashes."},numeric:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain only numbers."},integer:{method:function(e){return Berry.regex.integer.test(e)||""===e},message:"The {{label}} field must contain an integer."},decimal:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain a decimal number."},is_natural:{method:function(e){return naturalRegex.test(e)||""===e},message:"The {{label}} field must contain only positive numbers."},is_natural_no_zero:{method:function(e){return naturalNoZeroRegex.test(e)||""===e},message:"The {{label}} field must contain a number greater than zero."},valid_ip:{method:function(e){return ipRegex.test(e)||""===e},message:"The {{label}} field must contain a valid IP."},valid_url:{method:function(e){return urlRegex.test(e)||""===e},message:"The {{label}} field must contain a valid Url."},valid_base64:{method:function(e){return base64Regex.test(e)||""===e},message:"The {{label}} field must contain a base64 string."}}; !function(t,e){t.register({type:"checkbox",create:function(){return this.checkStatus(this.value),t.render("berry_checkbox",this)},checkStatus:function(t){this.value=t===!0||"true"===t||1===t||"1"===t||"on"===t||t==this.truestate?!0:!1},setup:function(){this.$el=this.self.find("[type=checkbox]"),void 0!==this.onchange&&this.$el.change(this.onchange),this.$el.change(e.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.$el.is(":checked")?this.truestate||!0:this.falsestate||!1},setValue:function(t){this.checkStatus(t),this.$el.prop("checked",this.value),this.value=t},displayAs:function(){for(var t in this.item.options)if(this.item.options[t].value==this.lastSaved)return this.item.options[t].name},focus:function(){this.$el.focus()}})}(Berry,jQuery); !function(i,t){i.register({type:"radio",create:function(){return this.options=i.processOpts(this.item).options,i.render("berry_radio",this)},setup:function(){this.$el=this.self.find("[type=radio]"),void 0!==this.onchange&&this.$el.change(this.onchange),this.$el.change(t.proxy(function(){this.trigger("change")},this))},getValue:function(){var i=this.self.find('[type="radio"]:checked').data("label");for(var t in this.item.options)if(this.item.options[t].label==i)return this.item.options[t].value},setValue:function(i){this.value=i,this.self.find('[value="'+this.value+'"]').prop("checked",!0)},displayAs:function(){for(var i in this.item.options)if(this.item.options[i].value==this.lastSaved)return this.item.options[i].label},focus:function(){this.self.find('[type="radio"]:checked').focus()}})}(Berry,jQuery); !function(t,e){t.register({type:"select",create:function(){return this.options=t.processOpts(this.item).options,t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find("select"),void 0!==this.onchange&&this.$el.change(this.onchange),this.$el.change(e.proxy(function(){this.trigger("change")},this))},displayAs:function(){var t=this.options;for(var e in t)if(t[e].value==this.lastSaved)return t[e].label}})}(Berry,jQuery); !function(e,t){e.register({type:"text"}),e.register({type:"raw"}),e.register({type:"password"}),e.register({type:"date"}),e.register({type:"range"}),e.register({type:"hidden",create:function(){return'<div><input type="hidden"  name="'+this.name+'" value="'+this.value+'" /></div>'}}),e.register({type:"url",defaults:{post:'<i class="fa fa-link"></i>',validate:{valid_url:!0}}}),e.register({type:"phone",defaults:{mask:"(999) 999-9999",post:'<i class="fa fa-phone"></i>',placeholder:"+1"}}),e.register({type:"email",defaults:{post:'<i class="fa fa-envelope"></i>',validate:{valid_email:!0}}}),e.register({type:"number",defaults:{elType:"text"},value:0,getValue:function(){var e=this.$el.val();return t.isNumeric(e)?parseFloat(e,10):""===e?e:(this.revert(),0)}}),e.register({type:"color",defaults:{pre:"<i></i>",type:"text"},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.parent().colorpicker("setValue",this.value),this.$el.val(e)},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),this.$el.attr("type","text"),this.$el.parent().colorpicker({format:"hex"}).on("changeColor",t.proxy(function(){this.trigger("change")},this))}}),e.register({type:"tags",defaults:{elType:"text"},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),t.fn.tagsInput&&this.$el.tagsInput()},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.importTags(e),this.$el.val(e)}})}(Berry,jQuery); Berry.register({type:"textarea","default":{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("textarea"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.advanced&&$.fn.htmlarea&&(this.$el.css({height:"300px"}).htmlarea({toolbar:this.item.toolbar||[["bold","italic","underline"],["superscript","subscript"],["justifyleft","justifycenter","justifyright"],["indent","outdent"],["orderedList","unorderedList"],["link","unlink"],["horizontalrule"]]}),this.$el.on("change",$.proxy(function(){this.trigger("change")},this))),this.autosize!==!1&&$.fn.autosize&&this.$el.autosize()},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t),this.autosize!==!1&&$.fn.autosize&&this.$el.trigger("autosize.resize"),this.item.advanced&&$.fn.htmlarea&&this.$el.htmlarea("updateHtmlArea",t),this.$el},focus:function(){this.$el.focus().val("").val(this.value),this.self.find("iframe").focus()}});
