function containsKey(e,t){var i={};for(var s in t)"undefined"!=typeof e[t[s]]&&(i[t[s]]=e[t[s]]);return i}Berry=function(e,t){this.list=function(e){var t=this.fields;return"undefined"!=typeof e&&(t=this.find(e)),temp=[],this.each(function(e){console.log(this.getPath()),e.push(this.getPath())},temp,t),temp},this.destroy=function(){this.each(function(){"function"==typeof this.destroy&&this.destroy()}),this.trigger("destroy"),this.$el.empty();for(var e in this.fieldsets)$(this.fieldsets[e]).empty();this.fields={},"function"==typeof this.renderer.destroy&&this.renderer.destroy(),delete Berry.instances[this.options.name],this.trigger("destroyed")},this.search=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");for(var i=t.split(".");i.length;){var s=i.shift();if(!(s in e))return e;e=e[s]}return e},this.toJSON=function(e,t){return t&&this.validate(),"string"==typeof e?this.search(this.attributes,e):(o(),this.working=$.extend(!0,{},this.attributes),this.working=i(this.working),this.options.flatten&&(this.deflated=[],this.each(function(){if(this.isContainer&&this.owner.options.flatten&&(null===this.instance_id||0===this.instance_id))if(this.isChild()){for(var e=this.parent.getPath().split("."),t=[],i=e.length-1;i>=0;i--){var s=e[i];-1===e.indexOf(s)&&t.push(s)}e=t;var n=e.pop(),r=e.join(".");e.length?this.owner.search(this.owner.working,r)[n]=this.owner.deflate(this.owner.search(this.owner.working,this.getPath())):n?this.owner.working[n]=this.owner.deflate(this.owner.search(this.owner.working,this.getPath())):($.extend(this.owner.working,this.owner.deflate(this.owner.search(this.owner.working,this.name))),delete this.owner.working[this.name]),this.owner.deflated.push(this.name)}else this.owner.deflated.push(this.name),$.extend(this.owner.working,this.owner.deflate(this.owner.working[this.name])),delete this.owner.working[this.name]}),this.working=this.deflate(this.working)),this.working)},this.deflate=function(e){var t,i={};for(var s in e)if("object"==typeof e[s])if($.isArray(e[s])){i[s]=[];for(t in e[s])i[s].push(e[s][t])}else{i[s]={};for(t in e[s])i[s][t]=e[s][t]}else i[s]=e[s];return i},this.populate=function(e){e=e||this.fields,this.each(function(){if(this.multiple){var e={};if(e=this.owner.toJSON(this.getPath())){var t=!0;for(var i in e)t?t=!1:this.owner.processField($.extend({},this.item,{id:Berry.getUID(),name:this.name}),$(this.self),this.parent,"after")}}},e),a.each(function(){if(!this.isContainer){var e=this.owner.toJSON(this.getPath());this.setValue(e||""),this.trigger("change"),this.toJSON()}},e)};var i=function(e){return a.altered=$.extend(!0,{},e),a.each(function(){if(this.multiple&&this.toArray){var e=this.owner.toJSON(this.getPath()),t=this.owner.attributes;this.isChild()&&(t=this.owner.search(this.owner.altered,this.parent.getPath())),t[this.name]={};for(var i in this.children)t[this.name][i]=$.pluck(e,i)}}),a.altered},s=function(){return a.each(function(){if(this.multiple&&this.toArray){var e=this.owner.attributes[this.name];if(this.isChild()&&(e=this.owner.search(this.owner.attributes,this.getSearchPath())),e){var t=$.extend(!0,{},e[this.name]);e[this.name]=[];var i=this.owner.source;this.isChild()&&(i=this.owner.search(this.owner.source,this.parent.getPath()));for(var s in i[this.name]){for(var n in i[this.name][s]){var r=$.extend({},t);for(var o in t)r[o]=i[this.name][o][n];e[this.name].push(r)}break}}}else this.owner.attributes[this.name]="object"==typeof this.owner.source[this.name]?$.isArray(this.owner.source[this.name])?$.extend([],this.owner.source[this.name]):$.extend({},this.owner.source[this.name]):this.owner.source[this.name]}),a.attributes},n=function(e,t){for(var i in t)"object"!=typeof t[i]||$.isArray(t[i])?i in e&&(t[i]=e[i]):t[i]=i in e?n(e[i],t[i]):n(e,t[i]);return t};this.toArray=function(){var e=[];for(var t in this.fields)e.push(this.fields[t]);return e},this.each=function(e,t,i){i=i||this.fields;var s=!0;for(var n in i){if(s===!1)break;var r=i[n];r.item?r.isActive()&&(s=e.call(r,t)):$.isEmptyObject(r.instances)||(s=this.each(e,t,r.instances)),$.isEmptyObject(r.children)||(s=this.each(e,t,r.children))}return s?t:s},this.find=function(e,t){var i=t||this.fields;e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,"");for(var s=e.split(".");s.length;){var n=s.shift(),r=this.shallowFind(n,i);if(!r)return!1;i=$.isEmptyObject(r.children)?r.fields||r:r.children}return i},this.shallowFind=function(e,t){t=t||this.fields;for(var i in t){if(i==e)return"undefined"!=typeof t[i].instances?t[i].multiple?t[i].instances:t[i].instances[0]:t[i];if(!$.isEmptyObject(field.children)){var s=this.shallowFind(e,field.children);if(s)return s}}return!1},this.processfields=function(e,t,i){for(var s in e)"string"==typeof e[s]&&(e[s]={type:e[s],label:s}),e[s]=$.extend({},a.options.default,e[s]),"undefined"!=typeof e[s].name||e[s].isContainer||(e[s].name="undefined"!=typeof e[s].id?e[s].id:s.toLowerCase().split(" ").join("_")),"undefined"==typeof e[s].label&&e[s].label!==!1&&(e[s].label=s),e[s].required&&$.extend(e[s],{validate:{required:!0}}),"undefined"!=typeof e[s].validate&&(e[s].required=e[s].validate.required),this.processField(e[s],t,i)},this.processField=function(e,t,i,s){if(field=$.extend({},a.options.default,e),void 0!==t[0]&&(t=t[0]),field.type in Berry.types){var n=r(field,i,t,s);return void 0===n.fieldset&&(n.fieldset=t),"before"==s?$(t).before(n.render()):"after"==s?$(t).after(n.render()):$(n.fieldset).append(n.render()),n.initialize(),n}return!1};var r=function(e,t,i){var s=new Berry.types[e.type](e,a);s.parent=t;var n=a.fields;null!==t&&void 0!==t&&(n=t.children);var r=void 0!==n[s.name];if(s.isContainer){r||(n[s.name]={isContainer:!0,multiple:s.multiple,hasChildren:!$.isEmptyObject(e.fields),toArray:s.item.toArray||s.owner.options.flatten,instances:[]});var o=n[s.name].instances.length,h=$(i).attr("id");for(var l in n[s.name].instances)if(n[s.name].instances[l].id==h){o=parseInt(l,10)+1;break}n[s.name].instances.splice(o,0,s);var u=0;for(var c in n[s.name].instances)n[s.name].instances[c].instance_id=u++}else if(r||s.multiple){if(n[s.name].isContainer){if(!a.options.flatten){var f=[];f.push(n[s.name]),f=n[s.name],n[s.name]={multiple:s.multiple,hasChildren:!$.isEmptyObject(e.fields),instances:[]},n[s.name].instances.push(f)}}else if(n[s.name]instanceof Berry.field){var f=[];f.push(n[s.name]),f=n[s.name],n[s.name]={instances:[]},n[s.name].instances.push(f)}n[s.name].instances.push(s)}else n[s.name]=s;return s},o=function(){return a.each(function(){if(!this.isContainer){var e;e=this.isChild()||null!==this.instance_id?this.owner.search(this.owner.attributes,this.parent.getPath()):this.owner.attributes,$.isArray(e)?e[this.parent.instance_id][this.name]=this.getValue():e[this.name]=this.getValue()}}),a.attributes},h=function(e){if(e){a.options.actionTarget||(a.options.actionTarget=$('<div class="berry-actions" style="overflow:hidden;padding-bottom:10px"></div>'),a.target.append(a.options.actionTarget)),e=containsKey(Berry.btn,e);for(var t in e){var i=$(Berry.render("berry__action",e[t]));"function"==typeof e[t].click&&i.click($.proxy(e[t].click,a)),a.options.actionTarget.append(i)}}},a=this;this.$el=t,this.fieldsets=[],this.section_count=0,this.sections=[],this.sectionList=[],this.options=$.extend(!0,{name:Berry.getUID(),errorClass:"has-error",errorTextClass:"font-xs.text-danger",options:{inline:!1},modifiers:"",renderer:"base",flatten:!0,autoDestroy:!1,autoFocus:!0,"default":{type:"text"},actions:["cancel","save"]},e),this.events=$.extend({},Berry.prototype.events),this.changed=!1,this.fields={},this.source={},this.attributes={},this.trigger("initialize"),"undefined"==typeof this.$el&&(t=$("<div/>")),this.renderer=new Berry.renderers[this.options.renderer](this),this.target=this.renderer.render(),this.options.legend&&this.options.legendTarget&&this.options.legendTarget.append(this.options.legend),this.processfields(this.options.fields,this.target,null),"undefined"!=typeof this.options.attributes&&("hash"===this.options.attributes&&(this.options.attributes=window.location.hash.replace("#","").split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e[t[0]]=t[1],e},{})),this.source=$.extend(!0,{},this.options.attributes),this.options.flatten&&(this.source=n($.extend(!0,{},this.source),$.extend(!0,{},i(this.attributes)))||{}),s(),this.populate()),h(this.options.actions),"function"==typeof this.renderer.initialize&&this.renderer.initialize(),this.options.autoFocus&&this.each(function(){return this.focus(),!1}),this.each(function(){this.trigger("change")}),Berry.instances[this.options.name]=this,this.on("dropped",function(e){var t=this.find(e.path),i="";for(var s in t)if(t[s].id==e.id){i=t[s].getPath(),t.splice(s,1);break}var n=a.attributes,r=i;r=r.replace(/\[(\w+)\]/g,".$1"),r=r.replace(/^\./,"");for(var o=r.split(".");o.length;){var h=o.shift();h in n&&(n=n[h])}if($.isArray(n))n.splice(s,1);else{delete n[s];for(var l in n)l>=s&&(n[s++]=n[l],delete n[l])}})},Berry.prototype.events={initialize:[]},Berry.prototype.addSub=function(e,t){this.events[e]||(this.events[e]=[]);var i=Berry.getUID();return this.events[e].push({token:i,func:t}),i},Berry.prototype.on=function(e,t,i){var s=/\s+/;if(s.test(e)){var n=e.split(s);for(var r in n)this.addSub(n[r],t)}else this.lastToken=this.addSub(e,t);return i&&t.call(this,null,e),this},Berry.prototype.off=function(e){for(var t in this.events)if(this.events[t])for(var i=0,s=this.events[t].length;s>i;i++)if(this.events[t][i].token===e)return this.events[t].splice(i,1),e;return this},Berry.prototype.processTopic=function(e,t){if(this.events[e])for(var i=this.events[e],s=i?i.length:0;s--;)i[s].func.call(this,t,e,i[s].token)},Berry.prototype.trigger=function(e,t){if(this.events[e])for(var i=this.events[e],s=i?i.length:0;s--;)i[s].func.call(this,t,e,i[s].token);if(newtopic=e.split(":")[0],newtopic!==e&&(e=newtopic,this.events[e]))for(var i=this.events[e],s=i?i.length:0;s--;)i[s].func.call(this,t,e,i[s].token);return this},Berries=Berry.instances={},Berry.field=function(e,t){this.children={},this.owner=t,this.hidden=!1,this.item=$.extend(!0,{},this.defaults,e),$.extend(this,this.owner.options.options,this.item),0!==e.value?"function"==typeof e.value?(this.valueFunc=e.value,this.liveValue=function(){return this.valueFunc.call(this.owner.toJSON())},e.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):"string"==typeof this.item.value&&0===this.item.value.indexOf("=")&&"undefined"!=typeof math?(this.template=Hogan.compile(this.item.value.substr(1),{delimiters:"{ }"}),this.liveValue=function(){var e=math.eval(this.template.render(this.owner.toJSON(),templates));return jQuery.isNumeric(e)?e.toFixed(this.item.precision||0):e},e.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):this.value=e.value||this.value||e.default||"":this.value=0,this.lastSaved=this.liveValue(),this.id=e.id||Berry.getUID(),this.self=void 0,this.fieldset=void 0,void 0!==this.item.fieldset&&$("."+this.item.fieldset).length>0?(this.fieldset=$("."+this.item.fieldset)[0],this.owner.fieldsets.push(this.fieldset)):void 0!==this.item.fieldset&&$("[name="+this.item.fieldset+"]").length>0&&(this.fieldset=$("[name="+this.item.fieldset+"]")[0],this.owner.fieldsets.push(this.fieldset)),this.val=function(e){return"undefined"!=typeof e&&this.set(e),this.getValue()}},$.extend(Berry.field.prototype,{type:"text",version:"1.0",isContainer:!1,instance_id:null,path:"",defaults:{},parent:null,getPath:function(){var e="";return null!==this.parent&&void 0!==this.parent&&(e=this.parent.getPath()+".",this.parent.multiple&&(e+=this.parent.instance_id+".")),e+this.name},getSearchPath:function(){var e="";return null!==this.parent&&void 0!==this.parent&&(e=this.parent.getSearchPath()+".",e+=this.parent.instance_id+"."),e+this.name},isActive:function(){return null===this.parent||this.parent.enabled!==!1},isChild:function(){return null!==this.parent},set:function(e){this.value!=e&&(this.value=e,this.setValue(this.value),this.trigger("change"))},revert:function(){this.value=this.lastSaved,this.item.value=this.lastSaved,this.setValue(this.value)},hasChildren:function(){return!$.isEmptyObject(this.children)},create:function(){return Berry.render("berry_"+(this.elType||this.type),this)},render:function(){return"undefined"==typeof this.self?this.self=$(this.create()).attr("data-Berry",this.owner.options.name):this.self.html($(this.create()).html()),this.display=this.getDisplay(),this.self},getValue:function(){return this.$el.val()},toJSON:function(){return this.value=this.getValue(),this.lastSaved=this.value,this.display=this.getDisplay(),this.lastSaved},liveValue:function(){return this.value},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.mask&&$.fn.mask&&this.$el.mask(this.item.mask)},createAttributes:function(){var e=this.owner.attributes;if(this.isContainer)this.multiple?(this.isChild()&&(e=this.owner.search(e,this.parent.getPath())),e[this.name]=e[this.name]||[]):e[this.name]={};else{var t=this.getPath();t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");for(var i=t.split(".");i.length;){var s=i.shift();e=s in e?e[s]:e[s]=s==this.name?this.value:{}}}},initialize:function(){this.multiple&&this.multiple.duplicate&&(this.self.find(".duplicate").click($.proxy(this.dupeMe,this)),this.self.find(".remove").click($.proxy(this.dropMe,this))),this.createAttributes(),this.setup(),"undefined"!=typeof this.show&&(this.showConditions=Berry.processConditions.call(this,this.show,function(e,t){this.showConditions[t]=e,this.self.show();for(var i in this.showConditions)if(!this.showConditions[i]){this.self.hide();break}})),"undefined"!=typeof this.enabled&&(this.enabledConditions=Berry.processConditions.call(this,this.enabled,function(e,t){this.enabledConditions[t]=e,this.enabledState=!0,this.enable();for(var i in this.enabledConditions)if(!this.enabledConditions[i]){this.enabledState=!1,this.disable();break}}))},on:function(e,t){this.owner.on(e+":"+this.name,t)},trigger:function(e){this.value=this.getValue(),this.owner.trigger(e+":"+this.name,{type:this.type,name:this.name,id:this.id,value:this.value,path:this.getPath()})},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.val(e)},update:function(e,t){$.extend(this.item,e),$.extend(this,this.item),this.setValue(this.value),this.render(),this.setup(),t||this.trigger("change")},blur:function(){this.$el.blur()},focus:function(){this.$el.focus().val("").val(this.value)},disable:function(){this.$el.prop("disabled",!0)},enable:function(){this.$el.prop("disabled",!1)},displayAs:function(){return this.lastSaved},getDisplay:function(){return void 0!==this.displayAs?void 0!==this.item.template?(this.display=this.displayAs(),Berry.render(this.item.template,this)[0]):this.displayAs()||"Empty":void 0!==this.item.template?Berry.render(this.item.template,this)[0]:this.lastSaved||"Empty"},destroy:function(){this.$el&&this.$el.off()},dupeMe:function(){var e=this.self,t=this.max||-1,i=$(e).siblings("[name="+this.name+"]").length+1;if(-1==t||t>i){var s=$.extend({},this.item,{id:Berry.getUID(),name:this.name});this.owner.processField(s,$(e),this.parent,"after"),this.owner.each(function(){this.createAttributes()}),this.trigger("change")}},dropMe:function(){var e=this.self,t=this.min||1,i=$(e).siblings("[name="+this.name+"]").length;if(i>=t){$(e).empty().remove();var s=0;this.trigger("dropped");var n=this.owner.find(this.getPath());for(var r in n)n[r].instance_id=s++;this.trigger("change")}}}),Berry.field.extend=function(e){var t=this,i=function(){return t.apply(this,arguments)},s=function(){this.constructor=i};return s.prototype=t.prototype,i.prototype=new s,e&&$.extend(i.prototype,e),i},Berry.types={},Berry.register=function(e){Berry.types[e.type]=Berry.field.extend(e)},Berry.register({type:"fieldset",getValue:function(){return null},create:function(){return this.name=this.name||Berry.getUID(),this.isChild()||(++this.owner.section_count,this.owner.sections.push(this),this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend,state:"disabled",completed:!1,active:!1,error:!1})),this.owner.fieldsets.push($('[name="'+this.name+'"]')[0]),this.owner.renderer.fieldset(this)},focus:function(){return this.owner.each(function(){return this.focus(),!1},{},this.children),!1},setValue:function(){return!0},setup:function(){void 0!==this.fields&&this.owner.processfields(this.fields,this.self,this)},isContainer:!0}),Berry.processConditions=function(e,t){if("string"==typeof e&&("show"===e||"display"===e?e=this.item.display||this.item.show:"enable"===e&&(e=this.item.enable)),"boolean"==typeof e)return e;if("object"==typeof e){var i=[];for(var s in e)i.push(Berry.conditions[s].call(this,this.owner,e[s],t));return i}return!0},Berry.conditions={requires:function(e,t,i){return e.on("change:"+t.name,$.proxy(function(e,t,s,n){i.call(this,null!==t.value&&""!==t.value,n)},this,t)).lastToken},not_matches:function(e,t,i){return e.on("change:"+t.name,$.proxy(function(e,t,s,n){i.call(this,e.value!==t.value,n)},this,t)).lastToken},matches:function(e,t,i){return e.on("change:"+t.name,$.proxy(function(e,t,s,n){i.call(this,e.value===t.value,n)},this,t)).lastToken}},$(function(e){e.fn.berry=function(e){return new Berry(e,this)}}(jQuery)),Berry.render=function(e,t){return(templates[e]||templates.berry_text).render(t,templates)},Berry.renderers={base:function(e){this.owner=e,this.initialize=function(){$(this.owner.$el).keydown(function(e){switch(e.keyCode){case 27:$("#close").click();break;case 13:e.ctrlKey&&$("#submit").click()}})},this.fieldset=function(e){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",e)},this.destroy=function(){$(this.owner.$el).off(),this.owner.$el.empty()},this.render=function(){return this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options)),this.owner.$el.find("form")}}},Berry.collections={},Berry.processOpts=function(e){if("function"==typeof e.choices)return e.choices.call(this);if("undefined"!=typeof e.max&&(e.min=e.min||0,e.step=e.step||1,e.choices=e.choices||[],e.min<=e.max))for(var t=e.min;t<=e.max;)e.choices.push(t.toString()),t+=e.step;if("undefined"!=typeof e.choices&&e.choices.length>0){if("string"==typeof e.choices){if("undefined"==typeof Berry.collections[e.choices])return $.ajax({url:e.choices,type:"get",success:$.proxy(function(t){Berry.collections[e.choices]=t,this.update({choices:t})},e)}),e.options=[],e;e.choices=Berry.collections[e.choices]}"object"!=typeof e.choices||$.isArray(e.choices)||(e.choices=e.choices.toJSON()),"undefined"!=typeof e.default&&e.choices.unshift(e.default),e.options=$.map(e.choices,function(e){return[e]})}if("undefined"!=typeof e.options&&e.options.length>0){var i=!1;for(var s in e.options){var n=e.options[s];("string"==typeof n||"number"==typeof n)&&(n={label:n},"index"!==e.key&&(n.value=n.label)),e.options[s]=$.extend({label:n.name,value:s},{label:n[e.key||"title"],value:n[e.reference||"id"]},n),i?e.options[s].selected=!1:("undefined"!=typeof e.value&&""!==e.value?e.options[s].selected=e.options[s].value==e.value:(e.options[s].selected=!0,e.value=e.options[s].value),i=e.options[s].selected)}}return e},Berry.btn={save:{label:"Save",icon:"check",id:"submit",modifier:"success pull-right",click:function(){this.options.autoDestroy&&this.on("saved",this.destroy),this.trigger("save")}},cancel:{label:"Cancel",icon:"times",id:"close",modifier:"default pull-left",click:function(){this.options.autoDestroy&&this.destroy(),this.trigger("cancel")}}},Berry.counter=0,Berry.getUID=function(){return"b"+Berry.counter++},Berry.prototype.sum=function(e){var t=this.toJSON(e),i=0;if("object"==typeof t){for(var s in t)i+=parseInt(t[s],10)||0;return i}return t},$.pluck=function(e,t){return $.map(e,function(e){return e[t]})}; !function(e,t){e.register({type:"checkbox",create:function(){return this.checkStatus(this.value),e.render("berry_checkbox",this)},checkStatus:function(e){this.value=e===!0||"true"===e||1===e||"on"===e||e==this.truestate?!0:!1},setup:function(){this.$el=this.self.find("[type=checkbox]"),void 0!==this.onchange&&this.$el.change(this.onchange),this.$el.change(t.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.self.find('[type="checkbox"]').is(":checked")},setValue:function(e){this.checkStatus(e),this.self.find('[name="'+this.name+'"]').prop("checked",this.value)},displayAs:function(){for(var e in this.item.options)if(this.item.options[e].value==this.lastSaved)return this.item.options[e].name},focus:function(){this.self.find('[type="checkbox"]:checked').focus()}})}(Berry,jQuery); !function(i,t){i.register({type:"radio",create:function(){return i.render("berry_radio",i.processOpts(this.item))},setup:function(){this.$el=this.self.find("[type=radio]"),void 0!==this.onchange&&this.$el.change(this.onchange),this.$el.change(t.proxy(function(){this.trigger("change")},this))},getValue:function(){var i=this.self.find('[type="radio"]:checked').data("label");for(var t in this.item.options)if(this.item.options[t].label==i)return this.item.options[t].value},setValue:function(i){this.value=i,this.self.find('[value="'+this.value+'"]').prop("checked",!0)},displayAs:function(){for(var i in this.item.options)if(this.item.options[i].value==this.lastSaved)return this.item.options[i].label},focus:function(){this.self.find('[type="radio"]:checked').focus()}})}(Berry,jQuery); !function(e,t){e.register({type:"select",create:function(){return e.render("berry_select",e.processOpts(this))},setup:function(){this.$el=this.self.find("select"),void 0!==this.onchange&&this.$el.change(this.onchange),this.$el.change(t.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.$el.children("option:selected").attr("value")},displayAs:function(){for(var e in this.options)if(this.options[e].value==this.lastSaved)return this.options[e].label}})}(Berry,jQuery); !function(e,t){e.register({type:"text"}),e.register({type:"raw"}),e.register({type:"password"}),e.register({type:"hidden",render:function(){return'<input type="hidden"  name="'+this.name+'" value="'+this.value+'" />'}}),e.register({type:"url",defaults:{post:'<i class="fa fa-link"></i>',validate:{valid_url:!0}}}),e.register({type:"phone",defaults:{mask:"(999) 999-9999",post:'<i class="fa fa-phone"></i>',placeholder:"+1"}}),e.register({type:"email",defaults:{post:'<i class="fa fa-envelope"></i>',validate:{valid_email:!0}}}),e.register({type:"number",defaults:{elType:"text"},value:0,getValue:function(){var e=this.$el.val();return t.isNumeric(e)?parseFloat(e,10):""===e?e:(this.revert(),0)}}),e.register({type:"tags",defaults:{elType:"text"},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),t.fn.tagsInput&&this.$el.tagsInput()},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.importTags(e),this.$el.val(e)}})}(Berry,jQuery); Berry.register({type:"textarea","default":{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("textarea"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.advanced&&$.fn.htmlarea&&(this.$el.css({height:"300px"}).htmlarea({toolbar:this.item.toolbar||[["bold","italic","underline"],["superscript","subscript"],["justifyleft","justifycenter","justifyright"],["indent","outdent"],["orderedList","unorderedList"],["link","unlink"],["horizontalrule"]]}),this.$el.on("change",$.proxy(function(){this.trigger("change")},this))),this.autosize!==!1&&$.fn.autosize&&this.$el.autosize()},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t),this.autosize!==!1&&$.fn.autosize&&this.$el.trigger("autosize.resize"),this.item.advanced&&$.fn.htmlarea&&this.$el.htmlarea("updateHtmlArea",t),this.$el},focus:function(){this.$el.focus().val("").val(this.value),this.self.find("iframe").focus()}}); Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){if("undefined"!=typeof this.options.model){this.on("save",function(){return this.validate()&&(this.trigger("saveing"),this.options.model.set(this.toJSON()),this.trigger("saved")),this.valid});var t=this.options.model.schema,e={},i=this.options.fields;if("all"===i||"undefined"==typeof this.options.fields)this.options.fields=t;else{for(var s in i)"string"==typeof i[s]?"undefined"!=typeof t[i[s]]&&(e[i[s]]=t[i[s]]):e["key_"+s]=i[s];this.options.fields=e}("undefined"==typeof this.options.attributes||$.isEmptyObject(this.options.attributes))&&(this.options.attributes=this.options.model.toJSON(),this.on("destroy",function(){this.options.model.on("change",null,this)}))}}}),Berry.register({type:"fieldset",getValue:function(){return null},create:function(){return this.name=this.name||Berry.getUID(),this.owner.fieldsets.push(this.name),this.isChild()||(++this.owner.section_count,this.owner.sections.push(this),this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend,state:"disabled",completed:!1,active:!1,error:!1})),this.owner.renderer.fieldset(this)},focus:function(){return this.owner.each(function(){return this.focus(),!1},{},this.children),!1},setValue:function(){return!0},setup:function(){if(void 0!==this.fields){if("undefined"!=typeof this.owner.options.model){var t=this.owner.options.model.schema,e={},i=this.fields;for(var s in i)"string"==typeof i[s]?"undefined"!=typeof t[i[s]]&&(e[i[s]]=t[i[s]]):e["key_"+s]=i[s];this.fields=e}this.owner.processfields(this.fields,this.self,this)}},isContainer:!0}); Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"undefined"!=typeof this.$el&&this.$el.length||(this.$el=$("<div/>"),this.ref=$(Berry.render("modal",this.options)),$(this.ref).appendTo("body"),this.options.legendTarget=this.ref.find(".modal-title"),this.options.actionTarget=this.ref.find(".modal-footer"),this.$el=this.ref.find(".modal-body"),this.ref.modal(),this.ref.on("shown.bs.modal",$.proxy(function(){this.$el.find(".form-control:first").focus()},this)),this.on("cancel",$.proxy(function(){this.ref.modal("hide")},this)),this.on("saved",$.proxy(function(){this.ref.modal("hide"),this.closeAction="save"},this)),this.ref.on("hidden.bs.modal",$.proxy(function(){this.closeAction=this.closeAction||"cancel",this.destroy()},this)),this.on("destroyed",$.proxy(function(){this.ref.remove(),this.trigger("completed")},this)))}}); Berry.prototype.valid=!0,Berry.prototype.validate=function(){return this.toJSON(),this.clearErrors(),this.each(this.validateItem),this.valid},Berry.prototype.validateItem=function(){this.owner.performValidate(this),this.owner.errors[this.item.name]=this.errors,this.owner.valid!==!1&&(this.owner.valid=this.valid)},Berry.prototype.performValidate=function(e,r){var t=e.item,a=e.value;if("undefined"!=typeof r&&(a=r),e.valid=!0,e.errors="",void 0!==t.validate&&"object"==typeof t.validate)for(var s in t.validate){if(!Berry.validations[s].method(a,t.validate[s])&&(void 0===t.show||e.owner.show(t.show))){e.valid=!1;var i=Berry.validations[s].message;"string"==typeof t.validate[s]&&(i=t.validate[s]),e.errors=i.replace("{{label}}",t.label)}e.self.toggleClass(e.owner.options.errorClass,!e.valid),e.self.find("."+e.owner.options.errorTextClass).html(e.errors)}},Berry.prototype.errors={},Berry.prototype.clearErrors=function(){this.valid=!0,this.errors={},this.$el.find("."+this.options.errorClass).removeClass(this.options.errorClass).find("."+this.options.errorTextClass).html("")},Berry.regex={},Berry.regex.numeric=/^[0-9]+$/,Berry.regex.integer=/^\-?[0-9]+$/,Berry.regex.decimal=/^\-?[0-9]*\.?[0-9]+$/,Berry.regex.email=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,Berry.regex.alpha=/^[a-z]+$/i,Berry.regex.alphaNumeric=/^[a-z0-9]+$/i,Berry.regex.alphaDash=/^[a-z0-9_-]+$/i,Berry.regex.natural=/^[0-9]+$/i,Berry.regex.naturalNoZero=/^[1-9][0-9]*$/i,Berry.regex.ip=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,Berry.regex.base64=/[^a-zA-Z0-9\/\+=]/i,Berry.regex.url=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,Berry.validations={required:{method:function(e){return null!==e&&""!==e},message:"The {{label}} field is required."},matches:{method:function(e,r){return el==this.Berry[r]?e===el.value:!1},message:"The {{label}} field does not match the %s field."},valid_email:{method:function(e){return Berry.regex.email.test(e)||""===e},message:"The {{label}} field must contain a valid email address."},valid_emails:{method:function(e){for(var r=e.split(","),t=0;t<r.length;t++)if(!Berry.regex.email.test(r[t]))return!1;return!0},message:"The {{label}} field must contain all valid email addresses."},min_length:{method:function(e,r){return Berry.regex.numeric.test(r)?e.length>=parseInt(r,10):!1},message:"The {{label}} field must be at least %s characters in length."},max_length:{method:function(e,r){return Berry.regex.numeric.test(r)?e.length<=parseInt(r,10):!1},message:"The {{label}} field must not exceed %s characters in length."},exact_length:{method:function(e,r){return Berry.regex.numericBerry.test(r)?e.length===parseInt(r,10):!1},message:"The {{label}} field must be exactly %s characters in length."},greater_than:{method:function(e,r){return decimalRegex.test(e)?parseFloat(e)>parseFloat(r):!1},message:"The {{label}} field must contain a number greater than %s."},less_than:{method:function(e,r){return decimalRegex.test(e)?parseFloat(e)<parseFloat(r):!1},message:"The {{label}} field must contain a number less than %s."},alpha:{method:function(e){return alphaRegex.test(e)||""===e},message:"The {{label}} field must only contain alphabetical characters."},alpha_numeric:{method:function(e){return alphaNumericRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters."},alpha_dash:{method:function(e){return alphaDashRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters, underscores, and dashes."},numeric:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain only numbers."},integer:{method:function(e){return Berry.regex.integer.test(e)||""===e},message:"The {{label}} field must contain an integer."},decimal:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain a decimal number."},is_natural:{method:function(e){return naturalRegex.test(e)||""===e},message:"The {{label}} field must contain only positive numbers."},is_natural_no_zero:{method:function(e){return naturalNoZeroRegex.test(e)||""===e},message:"The {{label}} field must contain a number greater than zero."},valid_ip:{method:function(e){return ipRegex.test(e)||""===e},message:"The {{label}} field must contain a valid IP."},valid_url:{method:function(e){return urlRegex.test(e)||""===e},message:"The {{label}} field must contain a valid Url."},valid_base64:{method:function(e){return base64Regex.test(e)||""===e},message:"The {{label}} field must contain a base64 string."}}; Berry.register({type:"contenteditable",create:function(){return Berry.render("berry_contenteditable",this)},setup:function(){this.$el=this.self.find(".formcontrol > div"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.editor=new Pen({editor:this.$el[0],list:["bold","italic","underline"]})},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.html(t),this.$el},getValue:function(){return this.$el.html()}}); !function(t,e){t.register({type:"custom_radio",create:function(){return t.render("berry_custom_radio",t.processOpts(this))},setup:function(){this.$el=this.self.find(".custom-group"),this.$el.children(".btn").off(),this.$el.children(".btn").on("click",e.proxy(function(t){this.$el.children(".btn-success").toggleClass("btn-success btn-white"),e(t.target).closest(".btn").toggleClass("btn-success btn-white"),"function"==typeof this.onchange&&this.onchange(),this.trigger("change")},this))},getValue:function(){return this.$el.children(".btn-success").attr("data-value")},setValue:function(t){return this.$el.children('[data-value="'+t+'"]').click()}})}(Berry,jQuery); !function(e,t){e.register({type:"custom_select",create:function(){return e.render("berry_custom_select",e.processOpts(this))},setup:function(){this.$el=this.self.find(".list-group"),this.$el.children(".list-group-item").off(),this.$el.children(".list-group-item").on("click",t.proxy(function(e){this.$el.children(".list-group-item-success").removeClass("list-group-item-success"),t(e.target).closest(".list-group-item").addClass("list-group-item-success"),"function"==typeof this.onchange&&this.onchange(),this.trigger("change")},this))},getValue:function(){return this.$el.children(".list-group-item-success").attr("data-value")},setValue:function(e){return this.$el.children('[data-value="'+e+'"]').click()}})}(Berry,jQuery); !function(t,e){t.register({type:"dropdown",create:function(){return t.render("berry_dropdown",t.processOpts(this))},setup:function(){this.$el=this.self.find(".btn-group"),this.$el.find("a").on("click",e.proxy(function(t){t.preventDefault(),this.setValue(e(t.target).data("value")),this.trigger("change"),void 0!==this.onchange&&this.onchange()},this))},setValue:function(t){return this.$el.find("ul").attr("data-value",t),this.$el.find("button").html(this.displayAs(t)+' <span class="caret"></span>')},getValue:function(){return this.$el.find("ul").attr("data-value")},displayAs:function(t){for(var e in this.options)if(this.options[e].value==(t||this.value))return this.options[e].label}})}(Berry,jQuery); !function(t,e){t.register({type:"rateit",create:function(){return t.render("berry_rateit",this)},setup:function(){this.render(),this.$el=this.self.find(".rateit"),this.$el.rateit(),this.$el.rateit("value",this.value),this.$el.bind("rated reset",e.proxy(function(){this.$el.focus(),this.trigger("change"),void 0!==this.onchange&&this.onchange()},this))},setValue:function(t){return this.value=t,this.$el.rateit("value",t)},getValue:function(){return this.$el.rateit("value")},getDisplay:function(){for(var t in this.options)if(this.options[t].value==this.lastSaved)return this.options[t].label;for(var e="",t=1;t<=this.value;t++)e+='<i class="fa fa-star"></i>';var i=Math.floor(this.value);this.value-i>=.5&&(e+='<i class="fa fa-star-half-full"></i>');for(var t=Math.round(this.value);5>t;t++)e+='<i class="fa fa-star-o"></i>';return e}})}(Berry,jQuery); Berry.register({type:"upload","default":{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("form input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),myDropzone=new Dropzone("#"+this.name,{method:"post",paramName:this.name,success:$.proxy(function(e,t){this.setValue(t.name),this.trigger("change")},this)})},getValue:function(){return this.value},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el}}); Berry.renderers.inline=function(e){this.owner=e,this.fieldset=function(e){Berry.render("berry_base_fieldset",e)},this.render=function(){return $("<div/>")},this.initialize=function(){"string"==typeof this.owner.options.popins&&this.owner.$el.html(Berry.render(this.owner.options.popins,{fields:this.owner.toArray()}));for(var e in this.owner.fields)this.create(this.owner.fields[e]);$(this.owner.$el).off("click",".popoverCancel"),$(this.owner.$el).on("click",".popoverCancel",function(){item=Berry.instances[$(this).closest(".row").data("berry")].fields[$(this).data("name")],item.revert(),Berry.renderers.inline.prototype.create(item),$("[name="+$(this).data("name")+"].popins").html(Berry.instances[$(this).closest(".row").data("berry")].fields[$(this).data("name")].display),$("[name="+$(this).data("name")+"].popins").focus()}),$(this.owner.$el).off("click",".popoverSave"),$(this.owner.$el).on("click",".popoverSave",function(){var e=Berry.instances[$(this).closest(".row").data("berry")],n=e.fields[$(this).data("name")];$(n.self).find(".form-control").blur(),e.performValidate(n,n.factory.toJSON(n.self)),n.valid?($("[name="+$(this).data("name")+"].popins").focus(),n.toJSON(),$("[name="+$(this).data("name")+"].popins").html(n.display),e.trigger("updated")):$(n.self).find(".form-control").focus()}),$(this.owner.$el).keydown(function(e){switch(e.keyCode){case 27:$(".popoverCancel").click();break;case 13:$(".popoverSave").click()}})}},Berry.renderers.inline.prototype.create=function(e){$(e.owner.$el).find("[name="+e.name+"].popins").on("click",$.proxy(function(){$(e.owner.$el).find("[name="+e.name+"].popins").html(this.self)},e))},Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"inline"==this.options.renderer&&this.save&&this.on("updated",function(){this.save()})}}); Berry.renderers.popins=function(e){this.owner=e,this.fieldset=function(e){Berry.render("berry_base_fieldset",e)},this.render=function(){return $("<div/>")},this.initialize=function(){"string"==typeof this.owner.options.popins_template&&this.owner.$el.html(Berry.render(this.owner.options.popins_template,{fields:this.owner.toArray()}));for(var e in this.owner.fields)this.create(this.owner.fields[e]);$("body").off("click",".popoverCancel"),$("body").on("click",".popoverCancel",function(){$(".popins").popover("hide"),field=Berry.instances[$(this).closest(".row").data("berry")].fields[$(this).data("name")],field.revert(),$("[name="+field.name+"].popins").popover("destroy").siblings(".popover").remove(),Berry.renderers.popins.prototype.create(field),$("[name="+$(this).data("name")+"].popins").focus()}),$("body").off("click",".popoverSave"),$("body").on("click",".popoverSave",function(){var e=Berry.instances[$(this).closest(".row").data("berry")],o=e.fields[$(this).data("name")];$(o.self).find(".form-control").blur(),e.performValidate(o,o.getValue()),o.valid?($("[name="+$(this).data("name")+"].popins").focus(),o.toJSON(),$("[name="+$(this).data("name")+"].popins").html(o.display).popover("hide"),e.trigger("updated")):o.focus()}),$("body").keydown(function(e){switch(e.keyCode){case 27:$(".popover.in .popoverCancel").click();break;case 13:$(".popover.in .popoverSave").click()}}),this.owner.each(function(){$("[name="+this.name+"].popins").html(this.display)})}},Berry.renderers.popins.prototype.create=function(e){var o=$.extend({title:e.prompt||e.label,content:e.self,html:!0,placement:"top",template:'<div class="popover berry"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'},e.owner.options.popins,e.popins),i=$("[name="+e.name+"].popins");i.popover(o),i.on("hidden.bs.popover",function(){$(".berry.popover").css({display:"none"})}),i.on("show.bs.popover",function(){$(".popover.in .popoverCancel").click()}),i.on("shown.bs.popover",function(){var e=Berry.instances[$(".berry.popover").find(".row").data("berry")].fields[$(".berry.popover").find(".row").attr("name")];e.initialize(),e.focus()})},Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"popins"==this.options.renderer&&($.extend(this.options.default,{hideLabel:!0}),this.save&&this.on("updated",function(){this.save()}))}}); Berry.renderers.tabs=function(e){this.owner=e,this.fieldset=function(e){return null===e.parent?Berry.render("berry_tabs_fieldset",e):Berry.render("berry_base_fieldset",e)},this.render=function(){return this.owner.$el.html(Berry.render("berry_base_form",this.owner.options)),this.owner.$el.find("form")},this.initialize=function(){this.owner.options.tabsTarget?this.owner.on("destroy",function(){this.options.tabsTarget.empty()}):this.owner.options.tabsTarget=this.owner.$el,this.owner.options.tabsTarget.prepend(Berry.render("berry_tabs",this.owner)).find("a:first").tab("show")}},Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"tabs"==this.options.renderer&&(this.options.modifiers+=" tab-content")}}); Berry.renderers.wizard=function(t){this.owner=t,this.fieldset=function(t){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",t)},this.render=function(){return this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options)),this.owner.$el.find("form")},this.$element=null,this.update=function(){this.$element.find("ul").html(Berry.render("berry_wizard_steps",this.owner)),$("#submit,#wizard-next").hide(),$(".step-pane").removeClass("active"),$("#step"+(this.owner.currentSection+1)).addClass("active"),this.owner.currentSection+1!=this.owner.section_count?$("#wizard-next").show():$("#submit").show(),0===this.owner.currentSection?$("#wizard-previous").hide():$("#wizard-previous").show(),this.$element.find("ul").first().attr("style","margin-left: 0");var t=0;this.$element.find("ul > li").each(function(){t+=$(this).outerWidth()});var e=0;if(e=this.$element.find(".actions").length?this.$element.width()-this.$element.find(".actions").first().outerWidth():this.$element.width(),t>e){var i=t-e;this.$element.find("ul").first().attr("style","margin-left: -"+i+"px"),this.$element.find("li."+this.owner.sectionList[this.owner.currentSection].state).first().position().left<200&&(i+=this.$element.find("li."+this.owner.sectionList[this.owner.currentSection].state).first().position().left-200,1>i?this.$element.find("ul").first().attr("style","margin-left: 0"):this.$element.find("ul").first().attr("style","margin-left: -"+i+"px"))}},this.next=function(){this.owner.valid=!0,this.owner.toJSON(),this.owner.each(this.owner.validateItem,null,this.owner.sections[this.owner.currentSection].children),this.owner.valid?this.owner.currentSection<this.owner.section_count-1&&(this.owner.sectionList[this.owner.currentSection].state="complete",this.owner.currentSection++,this.owner.clearErrors(),this.owner.sectionList[this.owner.currentSection].state="active"):this.owner.sectionList[this.owner.currentSection].state="error",this.update()},this.previous=function(){this.owner.currentSection>0&&(this.owner.sectionList[this.owner.currentSection].state="disabled",this.owner.currentSection--,this.owner.sectionList[this.owner.currentSection].state="active"),this.update()},this.sectionClick=function(t){var e=parseInt($(t.currentTarget).data("target").replace("#step",""),10)-1;if(e<this.owner.currentSection){for(var i=e;i<=this.owner.currentSection;i++)this.owner.sectionList[i].state="disabled";this.owner.currentSection=e,this.owner.sectionList[this.owner.currentSection].state="active"}this.update()},this.initialize=function(){this.owner.sectionList[0].state="active",this.owner.currentSection=0,this.owner.currentSection+1==this.owner.section_count?$("#wizard-next").hide():$("#submit").hide(),0===this.owner.currentSection?$("#wizard-previous").hide():$("#wizard-previous").show(),this.$element=this.owner.$el.find(".wizard"),this.$element.find("ul").html(Berry.render("berry_wizard_steps",this.owner)),$("#step1").addClass("active"),$("body").on("click",".wizard li",$.proxy(this.sectionClick,this)),$("body").on("click","#wizard-next",$.proxy(this.next,this)),$("body").on("click","#wizard-previous",$.proxy(this.previous,this))}},Berry.btn.previous={label:"Previous",icon:"arrow-left",id:"wizard-previous",modifier:"danger pull-right"},Berry.btn.next={label:"Next",icon:"arrow-right",id:"wizard-next",modifier:"success pull-right"},Berry.btn.finish=$.extend({},Berry.btn.save,{label:"Finish"}),Berry.prototype.events.initialize.push({token:Berry.getUID(),func:function(){"wizard"==this.options.renderer&&(this.options.actions=["cancel","finish","next","previous"])}});
