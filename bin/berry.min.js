Berry=function(e,t){this.destroy=function(){this.trigger("destroy"),this.each(function(){"function"==typeof this.destroy&&this.destroy()}),this.$el.empty();for(var e in this.fieldsets)$(this.fieldsets[e]).empty();"function"==typeof this.renderer.destroy&&this.renderer.destroy(),delete Berry.instances[this.options.name],this.trigger("destroyed")},this.toJSON=function(e,t){if(t&&this.validate(),"string"==typeof e)return this.find(e).getValue();var n=i(d(this.attributes));if(this.options.flatten){var s=[];this.each(r,[n,s,a]),n=a(n)}return n},this.populate=function(e,t){e=e||this.attributes,t=t||this.fields,this.each(function(e){if(this.multiple){var t={};if(t=Berry.search(e,this.getPath())){var i=!0;for(var n in t)i?i=!1:this.owner.processField($.extend(!0,{},this.item,{id:Berry.getUID(),name:this.name}),$(this.self),this.parent,"after")}}},[e],t),c.each(function(e){if(!this.isContainer){var t=Berry.search(e,this.getPath());"undefined"!=typeof t&&"object"!=typeof t&&(this.setValue(t),this.trigger("change"),this.toJSON())}},[e],t)};var i=function(e){var t=$.extend(!0,{},e);return c.each(function(e,t){if(this.multiple&&this.toArray){var i=e,n=Berry.search(i,this.getPath());this.isChild()&&(i=Berry.search(t,this.parent.getPath())),i[this.name]={};for(var s in this.children)i[this.name][s]=$.pluck(n,s)}},[e,t]),t},n=function(){return c.each(function(){var e=this.owner.attributes[this.name];if(this.multiple&&this.toArray){if(this.isChild()&&(e=Berry.search(this.owner.attributes,this.getPath(!0))),e){var t=$.extend(!0,{},e[this.name]);e[this.name]=[];var i=this.owner.source;this.isChild()&&(i=Berry.search(this.owner.source,this.parent.getPath()));for(var n in i[this.name]){for(var s in i[this.name][n]){var r=$.extend({},t);for(var a in t)r[a]=i[this.name][a][s];e[this.name].push(r)}break}}}else{var o=this.owner.source[this.name];null!==o&&(e="object"==typeof o?$.isArray(o)?$.extend([],o):$.extend({},o):o)}}),c.attributes},s=function(e,t){for(var i in t)"object"!=typeof t[i]||$.isArray(t[i])?i in e&&(t[i]=e[i]):t[i]=i in e?s(e[i],t[i]):s(e,t[i]);return t},r=function(e,t,i){if(this.isContainer&&this.owner.options.flatten&&(null===this.instance_id||0===this.instance_id))if(this.isChild()){for(var n=this.parent.getPath().split("."),s=[],r=n.length-1;r>=0;r--){var a=n[r];-1===n.indexOf(a)&&s.push(a)}n=s;var o=n.pop(),h=n.join(".");n.length?Berry.search(e,h)[o]=i(Berry.search(e,this.getPath())):o?e[o]=i(Berry.search(e,this.getPath())):($.extend(e,i(Berry.search(e,this.name))),delete e[this.name]),t.push(this.name)}else t.push(this.name),$.extend(e,i(e[this.name])),delete e[this.name]},a=function(e){var t,i={};for(var n in e)if("object"==typeof e[n])if($.isArray(e[n])){i[n]=[];for(t in e[n])i[n].push(e[n][t])}else{i[n]={};for(t in e[n])i[n][t]=e[n][t]}else i[n]=e[n];return i};this.each=function(e,t,i){i=i||this.fields;var n=!0;for(var s in i){if(n===!1)break;var r=i[s];r.item?r.isActive()&&(n=e.apply(r,t)):$.isEmptyObject(r.instances)||(n=this.each(e,t,r.instances)),$.isEmptyObject(r.children)||(n=this.each(e,t,r.children))}return n?t:n},this.find=function(e,t){var i=[];return this.each(function(e,t){(this.getPath()==e||this.name==e)&&t.push(this)},[e,i],t||this.fields),0==i.length?!1:i.length>1||i[0].multiple?i:i[0]},this.findByID=function(e,t){var i=[];return this.each(function(e,t){this.id==e&&t.push(this)},[e,i],t||this.fields),i[0]},this.processfields=function(e,t,i){for(var n in e)this.processField(o(e[n],n),t,i)};var o=function(e,t){return"string"==typeof e&&(e={type:e,label:t}),e=$.extend({},c.options.default,e),"undefined"!=typeof e.name||e.isContainer||(e.name="undefined"!=typeof e.id?e.id:t.toLowerCase().split(" ").join("_")),"undefined"==typeof e.label&&e.label!==!1&&(e.label=t),e.required&&$.extend(e,{validate:{required:!0}}),"undefined"!=typeof e.validate&&(e.required=e.validate.required),"undefined"==typeof Berry.types[e.type]&&(e.type="undefined"==typeof e.choices&&"undefined"==typeof e.options?"text":e.options.length<=3?"radio":"select"),e};this.processField=function(e,t,i,n){void 0!==t[0]&&(t=t[0]);var s=h(e,i,t,n);if("undefined"==typeof s.fieldset&&(s.fieldset=t),"before"==n)$(t).before(s.render());else if("after"==n)$(t).after(s.render());else if("fieldset"!==s.item.type||s.isChild()||!this.sectionsEnabled){var r;if("undefined"!=typeof $(s.fieldset).children(".row").last().attr("id")&&(r=l[$(s.fieldset).children(".row").last().attr("id")]),"undefined"==typeof r||r.used+parseInt(s.columns,10)+parseInt(s.offset,10)>this.options.columns){var a=Berry.getUID();r={},r.used=0,r.ref=$(Berry.render("berry_row",{id:a})),l[a]=r,$(s.fieldset).append(r.ref)}r.used+=parseInt(s.columns,10),r.used+=parseInt(s.offset,10),r.ref.append($("<div/>").addClass("col-md-"+s.columns).addClass("col-md-offset-"+s.offset).append(s.render()))}else $(s.fieldset).append(s.render());return s.initialize(),s};var h=function(e,t,i){var n=new Berry.types[e.type](e,c);n.parent=t;var s=c.fields;null!==t&&void 0!==t&&(s=t.children);var r=void 0!==s[n.name];if(n.isContainer){r||(s[n.name]={isContainer:!0,multiple:n.multiple,hasChildren:!$.isEmptyObject(e.fields),toArray:n.item.toArray||n.owner.options.flatten,instances:[]});var a=s[n.name].instances.length,o=$(i).attr("id");for(var h in s[n.name].instances)if(s[n.name].instances[h].id==o){a=parseInt(h,10)+1;break}s[n.name].instances.splice(a,0,n);var d=0;for(var f in s[n.name].instances)s[n.name].instances[f].instance_id=d++}else if(r||n.multiple){if(s[n.name].isContainer){if(!c.options.flatten){var l=[];l.push(s[n.name]),l=s[n.name],s[n.name]={multiple:n.multiple,hasChildren:!$.isEmptyObject(e.fields),instances:[]},s[n.name].instances.push(l)}}else if(s[n.name]instanceof Berry.field){var l=[];l.push(s[n.name]),l=s[n.name],s[n.name]={instances:[]},s[n.name].instances.push(l)}s[n.name].instances.push(n)}else s[n.name]=n;return n},d=function(e){var t=JSON.parse(JSON.stringify(e));return c.each(function(e){if(!this.isContainer&&this.isParsable){var t;(this.isChild()||null!==this.instance_id)&&(t=Berry.search(e,this.parent.getPath())),"undefined"==typeof t&&(t=e),$.isArray(t)?(t[this.parent.instance_id]||(t[this.parent.instance_id]={}),t[this.parent.instance_id][this.attribute||this.name]=this.getValue()):t[this.attribute||this.name]=this.getValue()}},[t]),t},f=function(e){if(e){c.options.actionTarget||(c.options.actionTarget=$('<div class="berry-actions" style="overflow:hidden;padding-bottom:10px"></div>'),c.target.append(c.options.actionTarget)),e=containsKey(Berry.btn,e);for(var t in e){var i=$(Berry.render("berry__action",e[t]));"function"==typeof e[t].click&&i.click($.proxy(e[t].click,c)),c.options.actionTarget.append(i)}}},c=this;this.$el=t,this.section_count=0,this.sectionsEnabled=!1,this.sections=[],this.sectionList=[];var l={};this.fieldsets=[],this.fields=[],this.source={},this.attributes={},this.options=$.extend({name:Berry.getUID()},Berry.options,e),this.events=$.extend({},Berry.prototype.events),this.trigger("initialize"),"undefined"==typeof this.$el&&(this.$el=$("<div/>")),this.renderer=new Berry.renderers[this.options.renderer](this),this.target=this.renderer.render(),this.options.legend&&this.options.legendTarget&&this.options.legendTarget.append(this.options.legend),this.processfields(this.options.fields,this.target,null),"undefined"!=typeof this.options.attributes&&("hash"===this.options.attributes&&(this.options.attributes=window.location.hash.replace("#","").split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e[t[0]]=t[1],e},{})),this.source=$.extend(!0,{},this.options.attributes),this.options.flatten&&(this.source=s($.extend(!0,{},this.source),$.extend(!0,{},i(this.attributes)))||{}),n(),this.each(function(){this.multiple&&this.createAttributes()})),this.populate(this.source),f(this.options.actions),"function"==typeof this.renderer.initialize&&this.renderer.initialize(),this.options.autoFocus&&this.each(function(){return this.focus(),!1}),this.each(function(){this.trigger("change")}),Berry.instances[this.options.name]=this,this.on("dropped",function(e){var t=c.findByID(e.id);Berry.search(c.attributes,e.path).splice(t.instance_id,1),t.isChild()?t.parent.children[t.name].instances.splice(t.instance_id,1):c.fields[t.name].instances.splice(t.instance_id,1)}),this.trigger("initialized")},Berries=Berry.instances={},Berry.types={},Berry.collections={},Berry.options={errorClass:"has-error",errorTextClass:"font-xs.text-danger",inline:!1,modifiers:"",renderer:"base",flatten:!0,columns:12,autoDestroy:!1,autoFocus:!0,actions:["cancel","save"]},Berry.register=function(e){Berry.types[e.type]=e.extends&&"undefined"!=typeof Berry.types[e.extends]?Berry.types[e.extends].extend(e):Berry.field.extend(e)},Berry.search=function(e,t){t=t.replace(/\[(\w+)\]/g,".$1");for(var i=t.split(".");i.length;){var n=i.shift();if(!("undefined"!=typeof e&&n in e))return e;e=e[n]}return e},$(function(e){e.fn.berry=function(e){return new Berry(e,this)}}(jQuery)); Berry.processConditions=function(n,e){if("string"==typeof n&&("show"===n||"enabled"===n||"parsable"===n?n=this.item[n]:"enable"===n&&(n=this.item.enable)),"boolean"==typeof n)return n;if("object"==typeof n){var t=[];for(var o in n)t.push(Berry.conditions[o].call(this,this.owner,n[o],e||n[o].callBack));return t}return!0},Berry.conditions={requires:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,a){t.call(this,null!==e.value&&""!==e.value,a)},this,e)).lastToken},not_matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,a){t.call(this,n.value!==e.value,a)},this,e)).lastToken},matches:function(n,e,t){return n.on("change:"+e.name,$.proxy(function(n,e,o,a){t.call(this,n.value===e.value,a)},this,e)).lastToken}}; Berry.prototype.events={initialize:[]},Berry.prototype.addSub=function(t,e){this.events[t]||(this.events[t]=[]);var i=Berry.getUID();return this.events[t].push({token:i,func:e}),i},Berry.prototype.on=function(t,e,i,s){var n=/\s+/;if(n.test(t)){var r=t.split(n);for(var o in r)"undefined"!=typeof i?this.addSub(r[o],$.proxy(e,i)):this.addSub(r[o],e)}else this.lastToken="undefined"!=typeof i?this.addSub(t,$.proxy(e,i)):this.addSub(t,e);return s&&e.call(this,null,t),this},Berry.prototype.delay=function(t,e,i,s){var n=function(t,e,i){clearTimeout(this.events[i].timer),this.events[i].timer=setTimeout($.proxy(function(){this.events[i].func.call(this)},this),s||250)},r=/\s+/;if(r.test(t)){var o=t.split(r);for(var h in o)this.lastToken=this.addSub(o[h],n),this.events[this.lastToken]={func:e,timer:null}}else this.lastToken=this.addSub(t,n),this.events[this.lastToken]={func:e,timer:null};return i&&e.call(this,null,t),this},Berry.prototype.off=function(t){for(var e in this.events)if(this.events[e])for(var i=0,s=this.events[e].length;s>i;i++)if(this.events[e][i].token===t)return this.events[e].splice(i,1),t;return this},Berry.prototype.trigger=function(t,e){if(this.events[t])for(var i=this.events[t],s=i?i.length:0;s--;)i[s].func.call(this,e,t,i[s].token);if(newtopic=t.split(":")[0],newtopic!==t&&(t=newtopic,this.events[t]))for(var i=this.events[t],s=i?i.length:0;s--;)i[s].func.call(this,e,t,i[s].token);return this}; Berry.field=function(t,i){this.children={},this.owner=i,this.hidden=!1,this.item=$.extend(!0,{},this.defaults,t),this.owner.trigger("initializeField",{field:this}),$.extend(this,this.owner.options.options,this.item),0!==t.value?"function"==typeof t.value?(this.valueFunc=t.value,this.liveValue=function(){return this.valueFunc.call(this.owner.toJSON())},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):"string"==typeof this.item.value&&0===this.item.value.indexOf("=")&&"undefined"!=typeof math?(this.formula=this.item.value.substr(1),this.liveValue=function(){try{var t=math.eval(this.formula,this.owner.toJSON());return $.isNumeric(t)?t.toFixed(this.item.precision||0):t}catch(i){return this.formula}},t.value=this.item.value=this.liveValue(),this.owner.on("change",$.proxy(function(){this.set(this.liveValue())},this))):this.value=t.value||this.value||t.default||"":this.value=0,this.lastSaved=this.liveValue(),this.id=t.id||Berry.getUID(),this.self=void 0,this.fieldset=void 0,"object"!=typeof this.item.fieldset?void 0!==this.item.fieldset&&$("."+this.item.fieldset).length>0?(this.fieldset=$("."+this.item.fieldset)[0],this.owner.fieldsets.push(this.fieldset)):void 0!==this.item.fieldset&&$("[name="+this.item.fieldset+"]").length>0&&(this.fieldset=$("[name="+this.item.fieldset+"]")[0],this.owner.fieldsets.push(this.fieldset)):this.item.fieldset.length&&(this.fieldset=this.item.fieldset),this.val=function(t){return"undefined"!=typeof t&&this.set(t),this.getValue()},this.columns=this.columns||this.owner.options.columns,this.columns>this.owner.options.columns&&(this.columns=this.owner.options.columns)},$.extend(Berry.field.prototype,{type:"text",offset:0,version:"1.0",isContainer:!1,isParsable:!0,isVisible:!0,enabledState:!0,instance_id:null,path:"",defaults:{},parent:null,getPath:function(t){var i="";return null!==this.parent&&void 0!==this.parent&&(i=this.parent.getPath(t)+".",(this.parent.multiple||t)&&(i+=this.parent.instance_id+".")),i+this.name},isActive:function(){return null===this.parent||this.parent.enabledState!==!1},isChild:function(){return null!==this.parent},set:function(t){this.value!=t&&(this.setValue(t),this.trigger("change"))},revert:function(){return this.item.value=this.lastSaved,this.setValue(this.lastSaved),this},hasChildren:function(){return!$.isEmptyObject(this.children)},create:function(){return Berry.render("berry_"+(this.elType||this.type),this)},render:function(){return"undefined"==typeof this.self?this.self=$(this.create()).attr("data-Berry",this.owner.options.name):this.self.html($(this.create()).html()),this.display=this.getDisplay(),this.self},getValue:function(){return this.$el.val()},toJSON:function(){return this.value=this.getValue(),this.lastSaved=this.value,this.display=this.getDisplay(),this.lastSaved},liveValue:function(){return this.value},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.mask&&$.fn.mask&&this.$el.mask(this.item.mask)},createAttributes:function(){var t=this.owner.attributes;if(this.isContainer)this.multiple?(this.isChild()&&(t=Berry.search(t,this.parent.getPath())),t[this.name]=t[this.name]||[]):t[this.name]={};else{var i=this.getPath();i=i.replace(/\[(\w+)\]/g,".$1"),i=i.replace(/^\./,"");for(var e=i.split(".");e.length;){var s=e.shift();t=s in t?t[s]:t[s]=s==this.name?this.value:{}}}},initialize:function(){this.multiple&&this.multiple.duplicate&&(this.self.find(".duplicate").click($.proxy(this.dupeMe,this)),this.self.find(".remove").click($.proxy(this.dropMe,this))),this.createAttributes(),this.setup(),"undefined"!=typeof this.show&&(this.isVisible=!0,this.showConditions=Berry.processConditions.call(this,this.show,function(t,i){this.showConditions[i]=t,this.self.show(),this.isVisible=!0;for(var e in this.showConditions)if(!this.showConditions[e]){this.isVisible=!1,this.self.hide();break}}),"boolean"==typeof this.showConditions&&(this.self.toggle(this.showConditions),this.isVisible=this.showConditions)),"undefined"!=typeof this.enabled&&(this.enabledConditions=Berry.processConditions.call(this,this.enabled,function(t,i){this.enabledConditions[i]=t,this.enabledState=!0,this.enable();for(var e in this.enabledConditions)if(!this.enabledConditions[e]){this.enabledState=!1,this.disable();break}})),"undefined"!=typeof this.parsable&&(this.parsableConditions=Berry.processConditions.call(this,this.parsable,function(t,i){this.parsableConditions[i]=t,this.isParsable=!0;for(var e in this.parsableConditions)if(!this.parsableConditions[e]){this.isParsable=!1;break}}))},on:function(t,i){this.owner.on(t+":"+this.name,i)},delay:function(t,i){this.owner.delay(t+":"+this.name,i)},trigger:function(t){this.value=this.getValue(),this.owner.trigger(t+":"+this.name,{type:this.type,name:this.name,id:this.id,value:this.value,path:this.getPath()})},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t)},update:function(t,i){"object"==typeof t&&$.extend(this.item,t),$.extend(this,this.item),this.setValue(this.value),this.render(),this.setup(),i||this.trigger("change")},blur:function(){this.$el.blur()},focus:function(){this.$el.focus().val("").val(this.value)},disable:function(){this.$el.prop("disabled",!0)},enable:function(){this.$el.prop("disabled",!1)},displayAs:function(){return this.lastSaved},getDisplay:function(){return void 0!==this.displayAs?void 0!==this.item.template?(this.display=this.displayAs(),Berry.render(this.item.template,this)):this.displayAs()||this.item.default||"Empty":void 0!==this.item.template?Berry.render(this.item.template,this):this.lastSaved||this.item.default||"Empty"},destroy:function(){this.$el&&this.$el.off()},dupeMe:function(){var t=this.self,i=this.max||-1,e=$(t).siblings("[name="+this.name+"]").length+1;if(-1==i||i>e){var s=$.extend({},this.item,{id:Berry.getUID(),name:this.name});this.owner.processField($.extend({},this.owner.options.default,s),$(t),this.parent,"after"),this.owner.each(function(){this.createAttributes()}),this.trigger("change")}},dropMe:function(){var t=this.self,i=this.min||1,e=$(t).siblings("[name="+this.name+"]").length;if(e>=i){$(t).empty().remove();var s=0;this.trigger("dropped");var n=this.owner.find(this.getPath());for(var h in n)n[h].instance_id=s++;this.trigger("change")}}}),Berry.field.extend=function(t){var i=this,e=function(){return i.apply(this,arguments)},s=function(){this.constructor=e};return s.prototype=i.prototype,e.prototype=new s,t&&$.extend(e.prototype,t),e},Berry.processOpts=function(t,i){if("undefined"!=typeof t.max&&(t.min=t.min||0,t.choices=t.choices||[],t.min<=t.max))for(var e=t.min;e<=t.max;e+=t.step||1)t.choices.push(e.toString());if("function"==typeof t.choices&&(t.options=t.choices.call(this,t)),"undefined"!=typeof t.choices&&t.choices.length>0){if("string"==typeof t.choices){if("undefined"==typeof Berry.collections[t.choices])return $.ajax({url:t.choices,type:"get",success:$.proxy(function(i){Berry.collections[t.choices]=i,this.update({choices:i,value:Berry.search(this.owner.attributes,this.getPath())})},i)}),t.options=[],t;t.choices=Berry.collections[t.choices]}if("object"==typeof t.choices&&!$.isArray(t.choices))for(var s in conditions)Berry.conditions[s].call(this,this.owner,conditions[s],function(){});"undefined"!=typeof t.default&&t.choices.unshift(t.default),t.options=$.map(t.choices,function(t){return[t]})}if("undefined"!=typeof t.options&&t.options.length>0){for(var n in t.options){var h=t.options[n];("string"==typeof h||"number"==typeof h)&&(h={label:h},"index"!==t.key&&(h.value=h.label)),t.options[n]=$.extend({label:h.name,value:n},{label:h[t.key||"title"],value:h[t.reference||"id"]},h),"undefined"!=typeof t.value&&""!==t.value&&(t.options[n].selected=$.isArray(t.value)?$.inArray(t.options[n].value,t.value)>-1:t.options[n].value==t.value)}}return t}; function containsKey(e,t){var r={};for(var i in t)"undefined"!=typeof e[t[i]]&&(r[t[i]]=e[t[i]]);return r}Berry.register({type:"fieldset",getValue:function(){return null},create:function(){return this.name=this.name||Berry.getUID(),this.isChild()||(++this.owner.section_count,this.owner.sections.push(this),this.owner.sectionList.push({index:this.owner.section_count,text:this.item.legend,state:"disabled",completed:!1,active:!1,error:!1})),this.owner.fieldsets.push($('[name="'+this.name+'"]')[0]),this.owner.renderer.fieldset(this)},focus:function(){return this.owner.each(function(){return this.focus(),!1},{},this.children),!1},setValue:function(){return!0},setup:function(){void 0!==this.fields&&this.owner.processfields(this.fields,this.self,this)},isContainer:!0}),Berry.render=function(e,t){return(templates[e]||templates.berry_text).render(t,templates)},Berry.renderers={base:function(e){this.owner=e,this.initialize=function(){$(this.owner.$el).keydown($.proxy(function(e){switch(e.keyCode){case 27:$("#close").click();break;case 13:e.ctrlKey&&this.owner.$el.find("[data-id=berry-submit]").click()}},this))},this.fieldset=function(e){return Berry.render("berry_"+this.owner.options.renderer+"_fieldset",e)},this.destroy=function(){$(this.owner.$el).off(),this.owner.$el.empty()},this.render=function(){return this.owner.$el.html(Berry.render("berry_"+this.owner.options.renderer+"_form",this.owner.options)),this.owner.$el.find("form")}}},Berry.btn={save:{label:"Save",icon:"check",id:"berry-submit",modifier:"success pull-right",click:function(){this.options.autoDestroy&&this.on("saved",this.destroy),this.trigger("save")}},cancel:{label:"Cancel",icon:"times",id:"berry-close",modifier:"default pull-left",click:function(){this.options.autoDestroy&&this.destroy(),this.trigger("cancel")}}},Berry.prototype.toArray=function(){return this.fields.map(function(){return this.fields})},Berry.counter=0,Berry.getUID=function(){return"b"+Berry.counter++},Berry.prototype.sum=function(e){var t=this.toJSON(e),r=0;if("object"==typeof t){for(var i in t)r+=parseInt(t[i],10)||0;return r}return t},$.pluck=function(e,t){return $.map(e,function(e){return e[t]})}; Berry.prototype.valid=!0,Berry.prototype.validate=function(){return this.toJSON(),this.clearErrors(),this.each(this.validateItem),this.valid},Berry.prototype.validateItem=function(){this.owner.performValidate(this),this.owner.errors[this.item.name]=this.errors,this.owner.valid!==!1&&(this.owner.valid=this.valid)},Berry.prototype.performValidate=function(e,t){var r=e.item,a=e.value;if("undefined"!=typeof t&&(a=t),e.valid=!0,e.errors="","undefined"!=typeof r.validate&&"object"==typeof r.validate)for(var i in r.validate){if(!Berry.validations[i].method(a,r.validate[i])&&("undefined"==typeof r.show||e.owner.isVisible)){e.valid=!1;var s=Berry.validations[i].message;"string"==typeof r.validate[i]&&(s=r.validate[i]),e.errors=s.replace("{{label}}",r.label)}e.self.toggleClass(e.owner.options.errorClass,!e.valid),e.self.find("."+e.owner.options.errorTextClass).html(e.errors)}},Berry.prototype.errors={},Berry.prototype.clearErrors=function(){this.valid=!0,this.errors={},this.$el.find("."+this.options.errorClass).removeClass(this.options.errorClass).find("."+this.options.errorTextClass).html("")},Berry.regex={},Berry.regex.numeric=/^[0-9]+$/,Berry.regex.integer=/^\-?[0-9]+$/,Berry.regex.decimal=/^\-?[0-9]*\.?[0-9]+$/,Berry.regex.email=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,Berry.regex.alpha=/^[a-z]+$/i,Berry.regex.alphaNumeric=/^[a-z0-9]+$/i,Berry.regex.alphaDash=/^[a-z0-9_-]+$/i,Berry.regex.natural=/^[0-9]+$/i,Berry.regex.naturalNoZero=/^[1-9][0-9]*$/i,Berry.regex.ip=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,Berry.regex.base64=/[^a-zA-Z0-9\/\+=]/i,Berry.regex.url=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,Berry.validations={required:{method:function(e){return null!==e&&""!==e},message:"The {{label}} field is required."},matches:{method:function(e,t){return el==this.Berry[t]?e===el.value:!1},message:"The {{label}} field does not match the %s field."},valid_email:{method:function(e){return Berry.regex.email.test(e)||""===e},message:"The {{label}} field must contain a valid email address."},valid_emails:{method:function(e){for(var t=e.split(","),r=0;r<t.length;r++)if(!Berry.regex.email.test(t[r]))return!1;return!0},message:"The {{label}} field must contain all valid email addresses."},min_length:{method:function(e,t){return Berry.regex.numeric.test(t)?e.length>=parseInt(t,10):!1},message:"The {{label}} field must be at least %s characters in length."},max_length:{method:function(e,t){return Berry.regex.numeric.test(t)?e.length<=parseInt(t,10):!1},message:"The {{label}} field must not exceed %s characters in length."},exact_length:{method:function(e,t){return Berry.regex.numericBerry.test(t)?e.length===parseInt(t,10):!1},message:"The {{label}} field must be exactly %s characters in length."},greater_than:{method:function(e,t){return decimalRegex.test(e)?parseFloat(e)>parseFloat(t):!1},message:"The {{label}} field must contain a number greater than %s."},less_than:{method:function(e,t){return decimalRegex.test(e)?parseFloat(e)<parseFloat(t):!1},message:"The {{label}} field must contain a number less than %s."},alpha:{method:function(e){return alphaRegex.test(e)||""===e},message:"The {{label}} field must only contain alphabetical characters."},alpha_numeric:{method:function(e){return alphaNumericRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters."},alpha_dash:{method:function(e){return alphaDashRegex.test(e)||""===e},message:"The {{label}} field must only contain alpha-numeric characters, underscores, and dashes."},numeric:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain only numbers."},integer:{method:function(e){return Berry.regex.integer.test(e)||""===e},message:"The {{label}} field must contain an integer."},decimal:{method:function(e){return decimalRegex.test(e)||""===e},message:"The {{label}} field must contain a decimal number."},is_natural:{method:function(e){return naturalRegex.test(e)||""===e},message:"The {{label}} field must contain only positive numbers."},is_natural_no_zero:{method:function(e){return naturalNoZeroRegex.test(e)||""===e},message:"The {{label}} field must contain a number greater than zero."},valid_ip:{method:function(e){return ipRegex.test(e)||""===e},message:"The {{label}} field must contain a valid IP."},valid_url:{method:function(e){return urlRegex.test(e)||""===e},message:"The {{label}} field must contain a valid Url."},valid_base64:{method:function(e){return base64Regex.test(e)||""===e},message:"The {{label}} field must contain a base64 string."}}; !function(t,e){t.register({type:"checkbox",defaults:{container:"span"},create:function(){return this.checkStatus(this.value),t.render("berry_checkbox",this)},checkStatus:function(t){this.value=t===!0||"true"===t||1===t||"1"===t||"on"===t||t==this.truestate?!0:!1},setup:function(){this.$el=this.self.find("[type=checkbox]"),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(e.proxy(function(){this.trigger("change")},this))},getValue:function(){return this.$el.is(":checked")?this.truestate||!0:this.falsestate||!1},setValue:function(t){this.checkStatus(t),this.$el.prop("checked",this.value),this.value=t},displayAs:function(){for(var t in this.item.options)if(this.item.options[t].value==this.lastSaved)return this.item.options[t].name},focus:function(){this.$el.focus()}})}(Berry,jQuery); !function(t,i){t.register({type:"radio",create:function(){return this.options=t.processOpts.call(this.owner,this.item,this).options,t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find("[type=radio]"),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(i.proxy(function(){this.trigger("change")},this))},getValue:function(){var t=this.self.find('[type="radio"]:checked').data("label");for(var i in this.item.options)if(this.item.options[i].label==t)return this.item.options[i].value},setValue:function(t){this.value=t,this.self.find('[value="'+this.value+'"]').prop("checked",!0)},displayAs:function(){for(var t in this.item.options)if(this.item.options[t].value==this.lastSaved)return this.item.options[t].label},focus:function(){this.self.find('[type="radio"]:checked').focus()}})}(Berry,jQuery); !function(t,e){t.register({type:"select",create:function(){return this.options=t.processOpts.call(this.owner,this.item,this).options,t.render("berry_"+(this.elType||this.type),this)},setup:function(){this.$el=this.self.find("select"),void 0!==this.onchange&&this.on("change",this.onchange),this.$el.change(e.proxy(function(){this.trigger("change")},this))},displayAs:function(){var t=this.options;for(var e in t)if(t[e].value==this.lastSaved)return t[e].label}})}(Berry,jQuery); !function(e,t){e.register({type:"text"}),e.register({type:"raw"}),e.register({type:"password"}),e.register({type:"date"}),e.register({type:"range"}),e.register({type:"hidden",create:function(){return'<div><input type="hidden"  name="'+this.name+'" value="'+this.value+'" /></div>'}}),e.register({type:"url",defaults:{post:'<i class="fa fa-link"></i>',validate:{valid_url:!0}}}),e.register({type:"phone",defaults:{mask:"(999) 999-9999",post:'<i class="fa fa-phone"></i>',placeholder:"+1"}}),e.register({type:"color",defaults:{pre:"<i></i>",type:"text"},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.parent().colorpicker("setValue",this.value),this.$el.val(e)},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),this.$el.attr("type","text"),this.$el.parent().colorpicker({format:"hex"}).on("changeColor",t.proxy(function(){this.trigger("change")},this))}}),e.register({type:"email",defaults:{post:'<i class="fa fa-envelope"></i>',validate:{valid_email:!0}}}),e.register({type:"number",defaults:{elType:"text"},value:0,getValue:function(){var e=this.$el.val();return""===e?0:t.isNumeric(e)?parseFloat(e,10):void 0}}),e.register({type:"tags",defaults:{elType:"text"},setup:function(){this.$el=this.self.find("input"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",t.proxy(function(){this.trigger("change")},this)),t.fn.tagsInput&&this.$el.tagsInput()},setValue:function(e){return"undefined"==typeof this.lastSaved&&(this.lastSaved=e),this.value=e,this.$el.importTags(e),this.$el.val(e)}})}(Berry,jQuery); Berry.register({type:"textarea","default":{autosize:!0,advanced:!1},setup:function(){this.$el=this.self.find("textarea"),this.$el.off(),void 0!==this.onchange&&this.$el.on("input",this.onchange),this.$el.on("input",$.proxy(function(){this.trigger("change")},this)),this.item.advanced&&$.fn.htmlarea&&(this.$el.css({height:"300px"}).htmlarea({toolbar:this.item.toolbar||[["bold","italic","underline"],["superscript","subscript"],["justifyleft","justifycenter","justifyright"],["indent","outdent"],["orderedList","unorderedList"],["link","unlink"],["horizontalrule"]]}),this.$el.on("change",$.proxy(function(){this.trigger("change")},this))),this.autosize!==!1&&$.fn.autosize&&this.$el.autosize()},setValue:function(t){return"undefined"==typeof this.lastSaved&&(this.lastSaved=t),this.value=t,this.$el.val(t),this.autosize!==!1&&$.fn.autosize&&this.$el.trigger("autosize.resize"),this.item.advanced&&$.fn.htmlarea&&this.$el.htmlarea("updateHtmlArea",t),this.$el},focus:function(){this.$el.focus().val("").val(this.value),this.self.find("iframe").focus()}});
