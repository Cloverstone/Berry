$(function(){cobler.register({type:"Content",category:"content",icon:"align-justify",display:"Editable Content",defaults:{text:"Add some text here...",width:12,type:"text",required:!1,help:""},createEL:function(){return this.$el=$(cb.options.editable?Berry.render("cobler_element",this):Berry.render("cobler_element_noedit",this)),this.$el.find(".cobler-li-content").append(this.toHTML()),this.$el},fields:[{type:"contenteditable",label:!1,name:"text",fieldset:"selected .cobler-li-content",unstyled:!0},{type:"select",label:"Width",name:"width",force:!0,choices:[{name:"Quarter",value:3},{name:"Half",value:6},{name:"Full",value:12}]}],blur:function(){0===this.attributes.text.length&&"<br>"!==this.attributes.text&&"Add some text here..."!==this.attributes.text&&this.owner.remove(this.id),$(".pen-menu").remove()},toHTML:function(){return $("<div>").html(this.attributes.text)},contentFields:!0,editView:function(){return""}})}); $(function(){cobler.register({type:"form",category:"content",icon:"check-square-o",display:"form",defaults:{form:""},fields:[{type:"custom_select",label:"Form",name:"form",reference:"_id",choices:"/forms"}],toHTML:function(){return this.attributes._id===this.attributes.form?this.attributes.content:void $.ajax({url:"/forms/"+this.attributes.form,success:$.proxy(function(t){this.attributes._id=t._id,this.attributes.content=t.content,this.attributes.title=t.title,this.attributes.content=Hogan.compile('<form id="{{_id}}" method="post" action="/records"><legend>{{title}}</legend>{{{content}}}<input type="hidden" name="form" value="{{_id}}"/><button type="submit" class="btn btn-default">Submit</button></form>').render(this.attributes,templates),this.$el.html(this.attributes.content)},this),error:function(){alert("Bad Response")}})}})}); $(function(){cobler.register({type:"gallery",category:"none",icon:"camera",display:"Gallery",defaults:{name:""},fields:[{type:"select",label:"Gallery",name:"name",reference:"name",fieldset:"alt-form",choices:"/galleries?list"}],blur:function(){0===this.attributes.name.length&&this.owner.remove(this.id)},toHTML:function(){return $("<div>").html(this.attributes.name)}})}); $(function(){cobler.register({type:"heading",category:"content",icon:"bold",display:"Heading",defaults:{text:"Heading",level:"h1"},fields:[{type:"custom_radio",force:!0,label:"Level",name:"level",fieldset:"alt-form",choices:[{name:"H1",value:"h1"},{name:"H2",value:"h2"},{name:"H3",value:"h3"}]},{label:!1,name:"text",fieldset:"selected .cobler-li-content div"}],toHTML:function(){return $("<"+this.attributes.level+">").html(this.attributes.text)},contentFields:!0,editView:function(){return'<div class="text'+this.attributes.level+'"></div>'}})}); $(function(){cobler.register({type:"image",category:"content",icon:"image",display:"Image",defaults:{image:""},fields:[{type:"custom_select",label:"Image",name:"image",reference:"name",fieldset:"alt-form",choices:"/images?list"},{label:"Alt-Text",name:"alt",fieldset:"alt-form"},{type:"select",label:"Width",name:"width",force:!0,choices:[{name:"Quarter",value:3},{name:"Half",value:6},{name:"Full",value:12}]}],blur:function(){0===this.attributes.image.length&&this.owner.remove(this.id)},template:'<div style=""><center>{{#image}}<img alt="{{alt}}" src="/imgs/{{image}}" />{{/image}}{{^image}}<div class="alert alert-info">Please choose an image</div>{{/image}}</center></div>',toHTML:function(){return Mustache.render(this.template,this.attributes)}})}); var markdownConverter=new Showdown.converter;$(function(){cobler.register({type:"markdown",category:"none",icon:"arrow-down",display:"Markdown",defaults:{label:"Label",type:"text",placeholder:"",help:""},fields:[{type:"textarea",label:!1,name:"text"}],blur:function(){0===this.attributes.markdown.length&&this.owner.remove(this.id)},toHTML:function(){var t=$("<div>").html(this.attributes.markdown);return t.addClass("pull-"+this.attributes.float+" width"+this.attributes.width).css({"text-align":this.attributes.align})},toJSON:function(){return this.attributes=$.extend(this.attributes,this.owner.form.toJSON()),this.attributes.markdown=markdownConverter.makeHtml(this.attributes.text),this.attributes}})}); $(function(){cobler.register({type:"oembed",category:"none",icon:"circle-o",display:"Embed",defaults:{url:"",id:""},fields:[{label:"URL",name:"url",fieldset:"alt-form"}],blur:function(){0===this.attributes.url.length&&this.owner.remove(this.id)},toHTML:function(){return $("<center/>").html($("<a/>").attr("href",this.attributes.url).addClass("embed"))},callback:function(){this.$el.find("a.embed").oembed(null,{includeHandle:!1})}})}); $(function(){cobler.register({type:"text",category:"none",icon:"align-justify",display:"Content",defaults:{text:"Add some text here...",width:"12",type:"text",required:!1,help:""},fields:[{type:"textarea",advanced:!0,label:"",name:"text",fieldset:"selected .cobler-li-content"},{type:"custom_radio",label:"Alignment",name:"align",choices:[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Justify",value:"justify"},{label:"Right",value:"right"}]},{type:"custom_radio",label:"Float",name:"float",choices:[{label:"Left",value:"left"},{label:"Right",value:"right"}]}],blur:function(){0===this.attributes.text.length&&this.owner.remove(this.id)},toHTML:function(){return $("<div>").html(this.attributes.text)},contentFields:!0,editView:function(){return""}})}); $(function(){cobler.register({type:"video",category:"content",icon:"video-camera",display:"Video",defaults:{url:"",id:""},fields:[{label:"URL",name:"url",fieldset:"alt-form"}],blur:function(){0===this.attributes.id.length&&this.owner.remove(this.id)},toJSON:function(){return this.attributes=$.extend(this.attributes,this.owner.form.toJSON()),this.attributes.url.length>0&&(this.attributes.provider=this.attributes.url.match(/https?:\/\/(:?www.)?(\w*)/)[2],"youtube"==this.attributes.provider?(this.attributes.id=this.attributes.url.replace(/^[^v]+v.(.{11}).*/,"$1"),this.attributes.target="http://www.youtube.com/v/"+this.attributes.id+"?version=3"):"vimeo"==this.attributes.provider&&(this.attributes.id=this.attributes.url.match(/http:\/\/(?:www.)?(\w*).com\/(\d*)/)[2],this.attributes.target="http://player.vimeo.com/video/"+this.attributes.id+"?title=0&amp;byline=0&amp;portrait=0")),this.attributes},toHTML:function(){var t=$("<div/>");return this.attributes.id.length>0&&("youtube"==this.attributes.provider?t.html(Mustache.render('<div style="text-align:center"><object style="height: 390px; width: 640px"><param name="wmode" value="transparent" /><param name="movie" value="{{target}}&rel=0"><param name="allowFullScreen" value="true"><param name="allowScriptAccess" value="always"><embed src="{{target}}&rel=0" type="application/x-shockwave-flash" allowfullscreen="true" allowScriptAccess="always" width="640" height="390" wmode="transparent"></object></div>',this.attributes)):"vimeo"==this.attributes.provider&&t.html(Mustache.render('<center><div style="text-align:center;width:400px;"><iframe src="{{target}}" style="width:400px;" width="400" height="300" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe></div></center>',this.attributes))),t}})});
